---
title: Verbessern der Startleistung mit Ngen-EF6
description: Verbessern der Startleistung mit ngen in Entity Framework 6
author: ajcvickers
ms.date: 10/23/2016
uid: ef6/fundamentals/performance/ngen
ms.openlocfilehash: a58ffc1a4da1cdb0ae12366ab1ec0139141b3a7f
ms.sourcegitcommit: 0a25c03fa65ae6e0e0e3f66bac48d59eceb96a5a
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/14/2020
ms.locfileid: "92065419"
---
# <a name="improving-startup-performance-with-ngen"></a><span data-ttu-id="4a437-103">Verbessern der Startleistung mit Ngen</span><span class="sxs-lookup"><span data-stu-id="4a437-103">Improving startup performance with NGen</span></span>
> [!NOTE]
> <span data-ttu-id="4a437-104">**Nur EF6 und höher:** Die Features, APIs usw., die auf dieser Seite erläutert werden, wurden in Entity Framework 6 eingeführt.</span><span class="sxs-lookup"><span data-stu-id="4a437-104">**EF6 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 6.</span></span> <span data-ttu-id="4a437-105">Wenn Sie eine frühere Version verwenden, gelten manche Informationen nicht.</span><span class="sxs-lookup"><span data-stu-id="4a437-105">If you are using an earlier version, some or all of the information does not apply.</span></span>  

<span data-ttu-id="4a437-106">Der .NET Framework unterstützt die Generierung von systemeigenen Images für verwaltete Anwendungen und Bibliotheken, damit Anwendungen schneller gestartet werden und in manchen Fällen weniger Arbeitsspeicher verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="4a437-106">The .NET Framework supports the generation of native images for managed applications and libraries as a way to help applications start faster and also in some cases use less memory.</span></span> <span data-ttu-id="4a437-107">Systemeigene Images werden durch die Übersetzung von verwalteten Codeassemblys in Dateien erstellt, die vor der Ausführung der Anwendung systemeigene Maschinenanweisungen enthalten, sodass der .net JIT-Compiler (Just-in-Time) die systemeigenen Anweisungen zur Laufzeit der Anwendung nicht generieren muss.</span><span class="sxs-lookup"><span data-stu-id="4a437-107">Native images are created by translating managed code assemblies into files containing native machine instructions before the application is executed, relieving the .NET JIT (Just-In-Time) compiler from having to generate the native instructions at application runtime.</span></span>  

<span data-ttu-id="4a437-108">Vor Version 6 waren die Kernbibliotheken der EF-Laufzeit Teil der .NET Framework, und Native Images wurden automatisch für Sie generiert.</span><span class="sxs-lookup"><span data-stu-id="4a437-108">Prior to version 6, the EF runtime’s core libraries were part of the .NET Framework and native images were generated automatically for them.</span></span> <span data-ttu-id="4a437-109">Ab Version 6 wurde die gesamte EF-Laufzeit in das nuget-Paket "EntityFramework" kombiniert.</span><span class="sxs-lookup"><span data-stu-id="4a437-109">Starting with version 6 the whole EF runtime has been combined into the EntityFramework NuGet package.</span></span> <span data-ttu-id="4a437-110">Native Images müssen nun mithilfe des Befehlszeilen Tools NGen.exe generiert werden, um ähnliche Ergebnisse zu erzielen.</span><span class="sxs-lookup"><span data-stu-id="4a437-110">Native images have to now be generated using the NGen.exe command line tool to obtain similar results.</span></span>  

<span data-ttu-id="4a437-111">Empirische Beobachtungen zeigen, dass systemeigene Images der EF-Laufzeitassemblys zwischen 1 und 3 Sekunden der Startzeit der Anwendung Ausschneiden können.</span><span class="sxs-lookup"><span data-stu-id="4a437-111">Empirical observations show that native images of the EF runtime assemblies can cut between 1 and 3 seconds of application startup time.</span></span>  

## <a name="how-to-use-ngenexe"></a><span data-ttu-id="4a437-112">Verwendung von NGen.exe</span><span class="sxs-lookup"><span data-stu-id="4a437-112">How to use NGen.exe</span></span>  

<span data-ttu-id="4a437-113">Die grundlegendste Funktion des NGen.exe Tools besteht darin, systemeigene Images für eine Assembly und alle direkten Abhängigkeiten zu installieren (d. h. um Datenträger zu erstellen und auf einem Datenträger zu speichern).</span><span class="sxs-lookup"><span data-stu-id="4a437-113">The most basic function of the NGen.exe tool is to “install” (that is, to create and persist to disk) native images for an assembly and all its direct dependencies.</span></span> <span data-ttu-id="4a437-114">So können Sie dies erreichen:</span><span class="sxs-lookup"><span data-stu-id="4a437-114">Here is how you can achieve that:</span></span>  

1. <span data-ttu-id="4a437-115">Öffnen Sie ein Eingabeaufforderungsfenster als ein Administrator.</span><span class="sxs-lookup"><span data-stu-id="4a437-115">Open a Command Prompt window as an administrator.</span></span>
2. <span data-ttu-id="4a437-116">Ändern Sie das aktuelle Arbeitsverzeichnis in den Speicherort der Assemblys, für die Sie Native Images generieren möchten:</span><span class="sxs-lookup"><span data-stu-id="4a437-116">Change the current working directory to the location of the assemblies you want to generate native images for:</span></span>

   ``` console
   cd <*Assemblies location*>  
   ```

3. <span data-ttu-id="4a437-117">Abhängig von Ihrem Betriebssystem und der Konfiguration der Anwendung müssen Sie möglicherweise systemeigene Images für die 32-Bit-Architektur, 64 Bit-Architektur oder beides generieren.</span><span class="sxs-lookup"><span data-stu-id="4a437-117">Depending on your operating system and the application’s configuration you might need to generate native images for 32 bit architecture, 64 bit architecture or for both.</span></span>

   <span data-ttu-id="4a437-118">Für 32-Bit-Run:</span><span class="sxs-lookup"><span data-stu-id="4a437-118">For 32 bit run:</span></span>

   ``` console
   %WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install <Assembly name>  
   ```

   <span data-ttu-id="4a437-119">Für 64-Bit-Run:</span><span class="sxs-lookup"><span data-stu-id="4a437-119">For 64 bit run:</span></span>
  
   ``` console
   %WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install <Assembly name>  
   ```

> [!TIP]
> <span data-ttu-id="4a437-120">Die Generierung System eigener Images für die falsche Architektur ist ein sehr häufiger Fehler.</span><span class="sxs-lookup"><span data-stu-id="4a437-120">Generating native images for the wrong architecture is a very common mistake.</span></span> <span data-ttu-id="4a437-121">Im Zweifelsfall können Sie einfach Native Images für alle Architekturen generieren, die für das auf dem Computer installierte Betriebssystem gelten.</span><span class="sxs-lookup"><span data-stu-id="4a437-121">When in doubt you can simply generate native images for all the architectures that apply to the operating system installed in the machine.</span></span>  

<span data-ttu-id="4a437-122">NGen.exe unterstützt auch andere Funktionen, wie z. b. das Deinstallieren und Anzeigen der installierten systemeigenen Images, das in die Warteschlange stehende generieren mehrerer Images usw. Weitere Informationen zur Verwendung finden Sie in der [NGen.exe-Dokumentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span><span class="sxs-lookup"><span data-stu-id="4a437-122">NGen.exe also supports other functions such as uninstalling and displaying the installed native images, queuing the generation of multiple images, etc. For more details of usage read the [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span></span>  

## <a name="when-to-use-ngenexe"></a><span data-ttu-id="4a437-123">Verwendungs NGen.exe</span><span class="sxs-lookup"><span data-stu-id="4a437-123">When to use NGen.exe</span></span>  

<span data-ttu-id="4a437-124">Wenn Sie entscheiden, welche Assemblys für die Generierung System eigener Images in einer Anwendung, die auf EF, Version 6 oder höher, basieren soll, sollten Sie die folgenden Optionen berücksichtigen:</span><span class="sxs-lookup"><span data-stu-id="4a437-124">When it comes to decide which assemblies to generate native images for in an application based on EF version 6 or greater, you should consider the following options:</span></span>  

- <span data-ttu-id="4a437-125">**Die Haupt-EF-Laufzeitassembly, EntityFramework.dll**: eine typische EF-basierte Anwendung führt beim Start oder beim ersten Zugriff auf die Datenbank eine beträchtliche Menge an Code aus dieser Assembly aus.</span><span class="sxs-lookup"><span data-stu-id="4a437-125">**The main EF runtime assembly, EntityFramework.dll**: A typical EF based application executes a significant amount of code from this assembly on startup or on its first access to the database.</span></span> <span data-ttu-id="4a437-126">Folglich führt das Erstellen von systemeigenen Images dieser Assembly zu den größten Vorteilen bei der Startleistung.</span><span class="sxs-lookup"><span data-stu-id="4a437-126">Consequently, creating native images of this assembly will produce the biggest gains in startup performance.</span></span>  
- <span data-ttu-id="4a437-127">**Eine beliebige EF-Anbieterassembly, die von Ihrer Anwendung verwendet wird**: die Startzeit kann auch leicht von der Generierung System eigener Images profitieren.</span><span class="sxs-lookup"><span data-stu-id="4a437-127">**Any EF provider assembly used by your application**: Startup time can also benefit slightly from generating native images of these.</span></span> <span data-ttu-id="4a437-128">Wenn die Anwendung z. b. den EF-Anbieter für SQL Server verwendet, sollten Sie ein System eigenes Image für EntityFramework.SqlServer.dll generieren.</span><span class="sxs-lookup"><span data-stu-id="4a437-128">For example, if the application uses the EF provider for SQL Server you will want to generate a native image for EntityFramework.SqlServer.dll.</span></span>  
- <span data-ttu-id="4a437-129">Die **Assemblys und andere Abhängigkeiten Ihrer Anwendung**: die [NGen.exe Dokumentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) behandelt allgemeine Kriterien für die Auswahl der Assemblys, für die systemeigene Images generiert werden sollen, sowie die Auswirkung von systemeigenen Images auf die Sicherheit, erweiterte Optionen wie "feste Bindung", Szenarien wie die Verwendung System eigener Images in Debug-und Profil Erstellungs Szenarien usw.</span><span class="sxs-lookup"><span data-stu-id="4a437-129">**Your application’s assemblies and other dependencies**: The [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) covers general criteria for choosing which assemblies to generate native images for and the impact of native images on security, advanced options such as “hard binding”, scenarios such as using native images in debugging and profiling scenarios, etc.</span></span>  

> [!TIP]
> <span data-ttu-id="4a437-130">Stellen Sie sicher, dass Sie die Auswirkungen der Verwendung System eigener Images auf die Startleistung und die Gesamtleistung Ihrer Anwendung sorgfältig messen, und vergleichen Sie Sie mit den tatsächlichen Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="4a437-130">Make sure you carefully measure the impact of using native images on both the startup performance and the overall performance of your application and compare them against actual requirements.</span></span> <span data-ttu-id="4a437-131">Während Native Images in der Regel dabei helfen, die Leistung beim Start zu verbessern und in einigen Fällen die Speicherauslastung zu reduzieren, sind nicht alle Szenarien gleichermaßen vorteilhaft.</span><span class="sxs-lookup"><span data-stu-id="4a437-131">While native images will generally help improve startup up performance and in some cases reduce memory usage, not all scenarios will benefit equally.</span></span> <span data-ttu-id="4a437-132">Beispielsweise kann der vom JIT-Compiler generierte Code bei der stabilen Zustands Ausführung (d. h., nachdem alle Methoden, die von der Anwendung verwendet werden, mindestens einmal aufgerufen wurde) eine etwas bessere Leistung als systemeigene Images erzielen.</span><span class="sxs-lookup"><span data-stu-id="4a437-132">For instance, on steady state execution (that is, once all the methods being used by the application have been invoked at least once) code generated by the JIT compiler can in fact yield slightly better performance than native images.</span></span>  

## <a name="using-ngenexe-in-a-development-machine"></a><span data-ttu-id="4a437-133">Verwenden von NGen.exe auf einem Entwicklungs Computer</span><span class="sxs-lookup"><span data-stu-id="4a437-133">Using NGen.exe in a development machine</span></span>  

<span data-ttu-id="4a437-134">Während der Entwicklung bietet der .net-JIT-Compiler den besten Kompromiss für Code, der häufig geändert wird.</span><span class="sxs-lookup"><span data-stu-id="4a437-134">During development the .NET JIT compiler will offer the best overall tradeoff for code that is changing frequently.</span></span> <span data-ttu-id="4a437-135">Das Generieren von systemeigenen Images für kompilierte Abhängigkeiten, wie z. b. die EF-Laufzeitassemblys, kann dazu beitragen, die Entwicklung und Tests zu beschleunigen, indem am Anfang jeder Ausführung</span><span class="sxs-lookup"><span data-stu-id="4a437-135">Generating native images for compiled dependencies such as the EF runtime assemblies can help accelerate development and testing by cutting a few seconds out at the beginning of each execution.</span></span>  

<span data-ttu-id="4a437-136">Eine gute Stelle zum Auffinden der EF-Laufzeitassemblys ist der Speicherort des nuget-Pakets für die Lösung.</span><span class="sxs-lookup"><span data-stu-id="4a437-136">A good place to find the EF runtime assemblies is the NuGet package location for the solution.</span></span> <span data-ttu-id="4a437-137">Beispielsweise können Sie für eine Anwendung, die EF 6.0.2 mit SQL Server und für .NET 4,5 oder höher verwendet, Folgendes in einem Eingabe Aufforderungs Fenster eingeben (denken Sie daran, es als Administrator zu öffnen):</span><span class="sxs-lookup"><span data-stu-id="4a437-137">For example, for an application using EF 6.0.2 with SQL Server and targeting .NET 4.5 or greater you can type the following in a Command Prompt window (remember to open it as an administrator):</span></span>  

```console
cd <Solution directory>\packages\EntityFramework.6.0.2\lib\net45
%WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install EntityFramework.SqlServer.dll
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install EntityFramework.SqlServer.dll
```  

> [!NOTE]
> <span data-ttu-id="4a437-138">Dadurch wird die Tatsache genutzt, dass bei der Installation der systemeigenen Images für den EF-Anbieter für SQL Server standardmäßig auch die systemeigenen Images für die Haupt-EF-Runtime-Assembly installiert werden.</span><span class="sxs-lookup"><span data-stu-id="4a437-138">This takes advantage of the fact that installing the native images for EF provider for SQL Server will also by default install the native images for the main EF runtime assembly.</span></span> <span data-ttu-id="4a437-139">Dies funktioniert, weil NGen.exe erkennen kann, dass EntityFramework.dll eine direkte Abhängigkeit von der EntityFramework.SqlServer.dll Assembly ist, die sich im selben Verzeichnis befindet.</span><span class="sxs-lookup"><span data-stu-id="4a437-139">This works because NGen.exe can detect that EntityFramework.dll is a direct dependency of the EntityFramework.SqlServer.dll assembly located in the same directory.</span></span>  

## <a name="creating-native-images-during-setup"></a><span data-ttu-id="4a437-140">Erstellen von systemeigenen Images während des Setups</span><span class="sxs-lookup"><span data-stu-id="4a437-140">Creating native images during setup</span></span>  

<span data-ttu-id="4a437-141">Das WiX-Toolkit unterstützt die Erstellung von systemeigenen Images für verwaltete Assemblys während des Setups in der Warteschlange, wie in dieser [Anleitung](https://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html)erläutert.</span><span class="sxs-lookup"><span data-stu-id="4a437-141">The WiX Toolkit supports queuing the generation of native images for managed assemblies during setup, as explained in this [how-to guide](https://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span></span> <span data-ttu-id="4a437-142">Eine weitere Alternative besteht darin, eine benutzerdefinierte Setup Aufgabe zu erstellen, mit der der NGen.exe Befehl ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="4a437-142">Another alternative is to create a custom setup task that execute the NGen.exe command.</span></span>  

## <a name="verifying-that-native-images-are-being-used-for-ef"></a><span data-ttu-id="4a437-143">Es wird überprüft, ob systemeigene Images für EF verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="4a437-143">Verifying that native images are being used for EF</span></span>  

<span data-ttu-id="4a437-144">Sie können überprüfen, ob eine bestimmte Anwendung eine native Assembly verwendet, indem Sie nach geladenen Assemblys mit der Erweiterung ".ni.dll" oder ".ni.exe" suchen.</span><span class="sxs-lookup"><span data-stu-id="4a437-144">You can verify that a specific application is using a native assembly by looking for loaded assemblies that have the extension “.ni.dll” or “.ni.exe”.</span></span> <span data-ttu-id="4a437-145">Beispielsweise wird ein System eigenes Image für die Haupt Laufzeit-Assembly von EF als EntityFramework.ni.dll bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="4a437-145">For example, a native image for the EF’s main runtime assembly will be called EntityFramework.ni.dll.</span></span> <span data-ttu-id="4a437-146">Eine einfache Möglichkeit zum Überprüfen der geladenen .NET-Assemblys eines Prozesses ist die Verwendung des [Prozess-Explorers](https://technet.microsoft.com/sysinternals/bb896653).</span><span class="sxs-lookup"><span data-stu-id="4a437-146">An easy way to inspect the loaded .NET assemblies of a process is to use [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span></span>  

## <a name="other-things-to-be-aware-of"></a><span data-ttu-id="4a437-147">Weitere Dinge, die Sie beachten sollten</span><span class="sxs-lookup"><span data-stu-id="4a437-147">Other things to be aware of</span></span>  

<span data-ttu-id="4a437-148">**Das Erstellen eines systemeigenen Images einer Assembly sollte nicht mit dem Registrieren der Assembly im [GAC (globaler Assemblycache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)verwechselt werden**.</span><span class="sxs-lookup"><span data-stu-id="4a437-148">**Creating a native image of an assembly should not be confused with registering the assembly in the [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span></span> <span data-ttu-id="4a437-149">NGen.exe ermöglicht das Erstellen von Images von Assemblys, die sich nicht im globalen Assemblycache befinden. tatsächlich können mehrere Anwendungen, die eine bestimmte Version von EF verwenden, dasselbe systemeigene Abbild gemeinsam verwenden.</span><span class="sxs-lookup"><span data-stu-id="4a437-149">NGen.exe allows creating images of assemblies that are not in the GAC, and in fact, multiple applications that use a specific version of EF can share the same native image.</span></span> <span data-ttu-id="4a437-150">Obwohl Windows 8 automatisch systemeigene Images für Assemblys erstellen kann, die im GAC platziert werden, ist die EF-Runtime für die Bereitstellung in Zusammenhang mit der Anwendung optimiert, und es wird nicht empfohlen, Sie im GAC zu registrieren, da dies negative Auswirkungen auf die Assemblyauflösung und die Wartung Ihrer Anwendungen unter anderen Aspekten</span><span class="sxs-lookup"><span data-stu-id="4a437-150">While Windows 8 can automatically create native images for assemblies placed in the GAC, the EF runtime is optimized to be deployed alongside your application and we do not recommend registering it in the GAC as this has a negative impact on assembly resolution and servicing your applications among other aspects.</span></span>  
