---
title: Das Entity Framework 6-Anbieter Modell EF6
description: Das Entity Framework 6-Anbieter Modell in Entity Framework 6
author: divega
ms.date: 06/27/2018
uid: ef6/fundamentals/providers/provider-model
ms.openlocfilehash: 4fc45ba5fe916253be348182196be236729d685d
ms.sourcegitcommit: abda0872f86eefeca191a9a11bfca976bc14468b
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/14/2020
ms.locfileid: "90074015"
---
# <a name="the-entity-framework-6-provider-model"></a><span data-ttu-id="e96a6-103">Das Entity Framework 6-Anbieter Modell</span><span class="sxs-lookup"><span data-stu-id="e96a6-103">The Entity Framework 6 provider model</span></span>

<span data-ttu-id="e96a6-104">Das Entity Framework-Anbieter Modell ermöglicht die Verwendung Entity Framework mit verschiedenen Typen von Datenbankservern.</span><span class="sxs-lookup"><span data-stu-id="e96a6-104">The Entity Framework provider model allows Entity Framework to be used with different types of database server.</span></span> <span data-ttu-id="e96a6-105">Ein Anbieter kann z. b. angeschlossen werden, damit EF für Microsoft SQL Server verwendet werden kann, während ein anderer Anbieter angeschlossen werden kann, damit EF für Microsoft SQL Server Compact Edition verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="e96a6-105">For example, one provider can be plugged in to allow EF to be used against Microsoft SQL Server, while another provider can be plugged into to allow EF to be used against Microsoft SQL Server Compact Edition.</span></span> <span data-ttu-id="e96a6-106">Die Anbieter für EF6, die wir kennen, finden Sie auf der Seite [Entity Framework Anbieter](xref:ef6/fundamentals/providers/index) .</span><span class="sxs-lookup"><span data-stu-id="e96a6-106">The providers for EF6 that we are aware of can be found on the [Entity Framework providers](xref:ef6/fundamentals/providers/index) page.</span></span>

<span data-ttu-id="e96a6-107">Es waren bestimmte Änderungen an der Art und Weise erforderlich, in der EF mit Anbietern interagiert, damit EF unter einer Open-Source-Lizenzfrei gegeben werden kann.</span><span class="sxs-lookup"><span data-stu-id="e96a6-107">Certain changes were required to the way EF interacts with providers to allow EF to be released under an open source license.</span></span> <span data-ttu-id="e96a6-108">Diese Änderungen erfordern die Neuerstellung von EF-Anbietern für die EF6-Assemblys und neue Mechanismen für die Registrierung des Anbieters.</span><span class="sxs-lookup"><span data-stu-id="e96a6-108">These changes require rebuilding of EF providers against the EF6 assemblies together with new mechanisms for registration of the provider.</span></span>

## <a name="rebuilding"></a><span data-ttu-id="e96a6-109">Neuerstellung</span><span class="sxs-lookup"><span data-stu-id="e96a6-109">Rebuilding</span></span>

<span data-ttu-id="e96a6-110">Mit EF6 wird der Kerncode, der zuvor Teil des .NET Framework war, jetzt als out-of-Band-Assemblys (OOB) ausgeliefert.</span><span class="sxs-lookup"><span data-stu-id="e96a6-110">With EF6 the core code that was previously part of the .NET Framework is now being shipped as out-of-band (OOB) assemblies.</span></span> <span data-ttu-id="e96a6-111">Ausführliche Informationen zum Erstellen von Anwendungen für EF6 finden Sie auf der Seite [Aktualisieren von Anwendungen für EF6](xref:ef6/what-is-new/upgrading-to-ef6) .</span><span class="sxs-lookup"><span data-stu-id="e96a6-111">Details on how to build applications against EF6 can be found on the [Updating applications for EF6](xref:ef6/what-is-new/upgrading-to-ef6) page.</span></span> <span data-ttu-id="e96a6-112">Anbieter müssen auch mit diesen Anweisungen neu erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-112">Providers will also need to be rebuilt using these instructions.</span></span>

## <a name="provider-types-overview"></a><span data-ttu-id="e96a6-113">Übersicht über Anbieter Typen</span><span class="sxs-lookup"><span data-stu-id="e96a6-113">Provider types overview</span></span>

<span data-ttu-id="e96a6-114">Ein EF-Anbieter ist wirklich eine Auflistung von anbieterspezifischen Diensten, die von CLR-Typen definiert werden, von denen diese Dienste (für eine Basisklasse) oder implementieren (für eine Schnittstelle).</span><span class="sxs-lookup"><span data-stu-id="e96a6-114">An EF provider is really a collection of provider-specific services defined by CLR types that these services extend from (for a base class) or implement (for an interface).</span></span> <span data-ttu-id="e96a6-115">Zwei dieser Dienste sind grundlegend und notwendig, damit EF überhaupt funktionsfähig ist.</span><span class="sxs-lookup"><span data-stu-id="e96a6-115">Two of these services are fundamental and necessary for EF to function at all.</span></span> <span data-ttu-id="e96a6-116">Andere sind optional und müssen nur implementiert werden, wenn bestimmte Funktionen erforderlich sind und/oder die Standard Implementierungen dieser Dienste für den spezifischen Datenbankserver nicht funktionieren.</span><span class="sxs-lookup"><span data-stu-id="e96a6-116">Others are optional and only need to be implemented if specific functionality is required and/or the default implementations of these services does not work for the specific database server being targeted.</span></span>

## <a name="fundamental-provider-types"></a><span data-ttu-id="e96a6-117">Grundlegende Anbieter Typen</span><span class="sxs-lookup"><span data-stu-id="e96a6-117">Fundamental provider types</span></span>

### <a name="dbproviderfactory"></a><span data-ttu-id="e96a6-118">DbProviderFactory</span><span class="sxs-lookup"><span data-stu-id="e96a6-118">DbProviderFactory</span></span>

<span data-ttu-id="e96a6-119">EF ist davon abhängig, dass ein von [System. Data. Common. DbProviderFactory](https://msdn.microsoft.com/library/system.data.common.dbproviderfactory.aspx) abgeleiteter Typ für den gesamten Datenbankzugriff auf niedriger Ebene vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="e96a6-119">EF depends on having a type derived from [System.Data.Common.DbProviderFactory](https://msdn.microsoft.com/library/system.data.common.dbproviderfactory.aspx) for performing all low-level database access.</span></span> <span data-ttu-id="e96a6-120">DbProviderFactory ist nicht Teil von EF, sondern ist stattdessen eine Klasse in der .NET Framework, die einen Einstiegspunkt für ADO.NET-Anbieter verwendet, der von EF, anderen O/RMS oder direkt von einer Anwendung verwendet werden kann, um Instanzen von Verbindungen, Befehlen, Parametern und anderen ADO.net-Abstraktionen in einer Anbieter agnostischen Weise abzurufen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-120">DbProviderFactory is not actually part of EF but is instead a class in the .NET Framework that serves an entry point for ADO.NET providers that can be used by EF, other O/RMs or directly by an application to obtain instances of connections, commands, parameters and other ADO.NET abstractions in a provider agnostic way.</span></span> <span data-ttu-id="e96a6-121">Weitere Informationen zu DbProviderFactory finden Sie in der [MSDN-Dokumentation zu ADO.net](https://msdn.microsoft.com/library/a6cd7c08.aspx).</span><span class="sxs-lookup"><span data-stu-id="e96a6-121">More information about DbProviderFactory can be found in the [MSDN documentation for ADO.NET](https://msdn.microsoft.com/library/a6cd7c08.aspx).</span></span>

### <a name="dbproviderservices"></a><span data-ttu-id="e96a6-122">DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="e96a6-122">DbProviderServices</span></span>

<span data-ttu-id="e96a6-123">EF hängt von der Verwendung eines Typs ab, der von DbProviderServices abgeleitet ist, um zusätzliche Funktionalität bereitzustellen, die von EF zusätzlich zu den bereits vom ADO.NET-Anbieter bereitgestellten Funktionen benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-123">EF depends on having a type derived from DbProviderServices for providing additional functionality needed by EF on top of the functionality already provided by the ADO.NET provider.</span></span> <span data-ttu-id="e96a6-124">In älteren Versionen von EF war die DbProviderServices-Klasse Teil des .NET Framework und wurde im System. Data. Common-Namespace gefunden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-124">In older versions of EF the DbProviderServices class was part of the .NET Framework and was found in the System.Data.Common namespace.</span></span> <span data-ttu-id="e96a6-125">Beginnend mit EF6 diese Klasse ist nun Teil EntityFramework.dll und befindet sich im System. Data. Entity. Core. Common-Namespace.</span><span class="sxs-lookup"><span data-stu-id="e96a6-125">Starting with EF6 this class is now part of EntityFramework.dll and is in the System.Data.Entity.Core.Common namespace.</span></span>

<span data-ttu-id="e96a6-126">Weitere Informationen zu den grundlegenden Funktionen einer DbProviderServices-Implementierung finden Sie auf der [MSDN](https://msdn.microsoft.com/library/ee789835.aspx)-Website.</span><span class="sxs-lookup"><span data-stu-id="e96a6-126">More details about the fundamental functionality of a DbProviderServices implementation can be found on [MSDN](https://msdn.microsoft.com/library/ee789835.aspx).</span></span> <span data-ttu-id="e96a6-127">Beachten Sie jedoch, dass zum Zeitpunkt der Erstellung dieser Informationen nicht für EF6 aktualisiert wird, obwohl die meisten Konzepte weiterhin gültig sind.</span><span class="sxs-lookup"><span data-stu-id="e96a6-127">However, note that as of the time of writing this information is not updated for EF6 although most of the concepts are still valid.</span></span> <span data-ttu-id="e96a6-128">Die SQL Server-und SQL Server Compact-Implementierungen von DbProviderServices werden ebenfalls in die [Open Source-Codebasis](https://github.com/aspnet/EntityFramework6/) eingecheckt und können als nützliche Verweise für andere Implementierungen dienen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-128">The SQL Server and SQL Server Compact implementations of DbProviderServices are also checked into to the [open-source codebase](https://github.com/aspnet/EntityFramework6/) and can serve as useful references for other implementations.</span></span>

<span data-ttu-id="e96a6-129">In älteren Versionen von EF wurde die zu verwendende DbProviderServices-Implementierung direkt von einem ADO.NET-Anbieter abgerufen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-129">In older versions of EF the DbProviderServices implementation to use was obtained directly from an ADO.NET provider.</span></span> <span data-ttu-id="e96a6-130">Dies erfolgt durch Umwandeln von DbProviderFactory in IServiceProvider und Aufrufen der GetService-Methode.</span><span class="sxs-lookup"><span data-stu-id="e96a6-130">This was done by casting DbProviderFactory to IServiceProvider and calling the GetService method.</span></span> <span data-ttu-id="e96a6-131">Dadurch wurde der EF-Anbieter eng an die DbProviderFactory gekoppelt.</span><span class="sxs-lookup"><span data-stu-id="e96a6-131">This tightly coupled the EF provider to the DbProviderFactory.</span></span> <span data-ttu-id="e96a6-132">Diese Kopplung blockierte EF daran, nicht aus der .NET Framework verschoben zu werden. Daher wurde diese enge Kopplung entfernt, und eine Implementierung von DbProviderServices ist jetzt direkt in der Konfigurationsdatei der Anwendung oder in der Code basierten Konfiguration registriert, wie im Abschnitt Registrieren von _DbProviderServices_ weiter unten beschrieben.</span><span class="sxs-lookup"><span data-stu-id="e96a6-132">This coupling blocked EF from being moved out of the .NET Framework and therefore for EF6 this tight coupling has been removed and an implementation of DbProviderServices is now registered directly in the application’s configuration file or in code-based configuration as described in more detail the _Registering DbProviderServices_ section below.</span></span>

## <a name="additional-services"></a><span data-ttu-id="e96a6-133">Zusätzliche Dienste</span><span class="sxs-lookup"><span data-stu-id="e96a6-133">Additional services</span></span>

<span data-ttu-id="e96a6-134">Zusätzlich zu den grundlegenden Diensten, die oben beschrieben werden, gibt es auch viele andere Dienste, die von EF verwendet werden, die entweder immer oder manchmal Anbieter spezifisch sind.</span><span class="sxs-lookup"><span data-stu-id="e96a6-134">In addition to the fundamental services described above there are also many other services used by EF which are either always or sometimes provider-specific.</span></span> <span data-ttu-id="e96a6-135">Standardmäßige anbieterspezifische Implementierungen dieser Dienste können durch eine DbProviderServices-Implementierung bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-135">Default provider-specific implementations of these services can be supplied by a DbProviderServices implementation.</span></span> <span data-ttu-id="e96a6-136">Anwendungen können auch die Implementierungen dieser Dienste überschreiben oder Implementierungen bereitstellen, wenn ein DbProviderServices-Typ keinen Standardwert bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="e96a6-136">Applications can also override the implementations of these services, or provide implementations when a DbProviderServices type does not provide a default.</span></span> <span data-ttu-id="e96a6-137">Dies wird im Abschnitt " _Auflösen zusätzlicher Dienste_ " ausführlicher beschrieben.</span><span class="sxs-lookup"><span data-stu-id="e96a6-137">This is described in more detail in the _Resolving additional services_ section below.</span></span>

<span data-ttu-id="e96a6-138">Die zusätzlichen Dienst Typen, die ein Anbieter für einen Anbieter interessieren kann, sind unten aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="e96a6-138">The additional service types that a provider may be of interest to a provider are listed below.</span></span> <span data-ttu-id="e96a6-139">Weitere Informationen zu den einzelnen Dienst Typen finden Sie in der API-Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="e96a6-139">More details about each of these service types can be found in the API documentation.</span></span>

### <a name="idbexecutionstrategy"></a><span data-ttu-id="e96a6-140">IDbExecutionStrategy</span><span class="sxs-lookup"><span data-stu-id="e96a6-140">IDbExecutionStrategy</span></span>

<span data-ttu-id="e96a6-141">Dies ist ein optionaler Dienst, der es einem Anbieter ermöglicht, Wiederholungs Versuche oder andere Verhalten zu implementieren, wenn Abfragen und Befehle für die Datenbank ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-141">This is an optional service that allows a provider to implement retries or other behavior when queries and commands are executed against the database.</span></span> <span data-ttu-id="e96a6-142">Wenn keine Implementierung bereitgestellt wird, führt EF die Befehle einfach aus und verteilt alle ausgelösten Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-142">If no implementation is provided, then EF will simply execute the commands and propagate any exceptions thrown.</span></span> <span data-ttu-id="e96a6-143">Bei SQL Server dieser Dienst zum Bereitstellen einer Wiederholungs Richtlinie verwendet, die besonders nützlich ist, wenn Sie auf cloudbasierten Datenbankservern wie SQL Azure ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-143">For SQL Server this service is used to provide a retry policy which is especially useful when running against cloud-based database servers such as SQL Azure.</span></span>

### <a name="idbconnectionfactory"></a><span data-ttu-id="e96a6-144">Idbconnectionfactory</span><span class="sxs-lookup"><span data-stu-id="e96a6-144">IDbConnectionFactory</span></span>

<span data-ttu-id="e96a6-145">Dies ist ein optionaler Dienst, mit dem ein Anbieter DbConnection-Objekte gemäß der Konvention erstellen kann, wenn nur ein Datenbankname angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-145">This is an optional service that allows a provider to create DbConnection objects by convention when given only a database name.</span></span> <span data-ttu-id="e96a6-146">Beachten Sie, dass dieser Dienst zwar durch eine DbProviderServices-Implementierung aufgelöst werden kann, aber er ist seit EF 4,1 vorhanden und kann auch explizit in der Konfigurationsdatei oder im Code festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-146">Note that while this service can be resolved by a DbProviderServices implementation it has been present since EF 4.1 and can also be explicitly set in either the config file or in code.</span></span> <span data-ttu-id="e96a6-147">Der Anbieter erhält nur die Möglichkeit, diesen Dienst aufzulösen, wenn er als Standardanbieter registriert ist (siehe _Standardanbieter_ unten) und eine standardverbindungsfactory nicht an anderer Stelle festgelegt wurde.</span><span class="sxs-lookup"><span data-stu-id="e96a6-147">The provider will only get a chance to resolve this service if it registered as the default provider (see _The default provider_ below) and if a default connection factory has not been set elsewhere.</span></span>

### <a name="dbspatialservices"></a><span data-ttu-id="e96a6-148">Dbspatialservices</span><span class="sxs-lookup"><span data-stu-id="e96a6-148">DbSpatialServices</span></span>

<span data-ttu-id="e96a6-149">Dies ist ein optionaler Dienst, mit dem ein Anbieter Unterstützung für räumliche Geography-und geometry-Typen hinzufügen kann.</span><span class="sxs-lookup"><span data-stu-id="e96a6-149">This is an optional services that allows a provider to add support for geography and geometry spatial types.</span></span> <span data-ttu-id="e96a6-150">Eine Implementierung dieses Dienstanbieter muss bereitgestellt werden, damit eine Anwendung EF mit räumlichen Typen verwenden können.</span><span class="sxs-lookup"><span data-stu-id="e96a6-150">An implementation of this service must be supplied in order for an application to use EF with spatial types.</span></span> <span data-ttu-id="e96a6-151">Dbsptialservices wird auf zwei Arten angefordert.</span><span class="sxs-lookup"><span data-stu-id="e96a6-151">DbSptialServices is asked for in two ways.</span></span> <span data-ttu-id="e96a6-152">Zuerst werden anbieterspezifische räumliche Dienste mithilfe eines dbproviderinfo-Objekts (das den invarianten Namen und das Manifest-Token enthält) als Schlüssel angefordert.</span><span class="sxs-lookup"><span data-stu-id="e96a6-152">First, provider-specific spatial services are requested using a DbProviderInfo object (which contains invariant name and manifest token) as key.</span></span> <span data-ttu-id="e96a6-153">Zweitens können dbspatialservices ohne Schlüssel angefordert werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-153">Second, DbSpatialServices can be asked for with no key.</span></span> <span data-ttu-id="e96a6-154">Dies wird zum Auflösen des "globalen räumlichen Anbieters" verwendet, der beim Erstellen eigenständiger dbgeography-oder dbgeometry-Typen verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-154">This is used to resolve the “global spatial provider” that is used when creating stand-alone DbGeography or DbGeometry types.</span></span>

### <a name="migrationsqlgenerator"></a><span data-ttu-id="e96a6-155">Migrationsqlgenerator</span><span class="sxs-lookup"><span data-stu-id="e96a6-155">MigrationSqlGenerator</span></span>

<span data-ttu-id="e96a6-156">Dies ist ein optionaler Dienst, mit dem EF-Migrationen für die Generierung von SQL verwendet werden können, die beim Erstellen und Ändern von Datenbankschemas durch Code First verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-156">This is an optional service that allows EF Migrations to be used for the generation of SQL used in creating and modifying database schemas by Code First.</span></span> <span data-ttu-id="e96a6-157">Eine-Implementierung ist erforderlich, um Migrationen zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-157">An implementation is required in order to support Migrations.</span></span> <span data-ttu-id="e96a6-158">Wenn eine Implementierung bereitgestellt wird, wird Sie auch verwendet, wenn Datenbanken mithilfe von datenbankinitialisierern oder der Database. Create-Methode erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-158">If an implementation is provided then it will also be used when databases are created using database initializers or the Database.Create method.</span></span>

### <a name="funcdbconnection-string-historycontextfactory"></a><span data-ttu-id="e96a6-159">Func<DbConnection, String, historycontextfactory></span><span class="sxs-lookup"><span data-stu-id="e96a6-159">Func<DbConnection, string, HistoryContextFactory></span></span>

<span data-ttu-id="e96a6-160">Dies ist ein optionaler Dienst, mit dem ein Anbieter die Zuordnung von historycontext zu der `__MigrationHistory` von EF-Migrationen verwendeten Tabelle konfigurieren kann.</span><span class="sxs-lookup"><span data-stu-id="e96a6-160">This is an optional service that allows a provider to configure the mapping of the HistoryContext to the `__MigrationHistory` table used by EF Migrations.</span></span> <span data-ttu-id="e96a6-161">Der historycontext ist eine Code First dbcontext und kann mit der normalen flüssigen API konfiguriert werden, um Dinge wie den Namen der Tabelle und die Spalten Mappingspezifikationen zu ändern.</span><span class="sxs-lookup"><span data-stu-id="e96a6-161">The HistoryContext is a Code First DbContext and can be configured using the normal fluent API to change things like the name of the table and the column mapping specifications.</span></span> <span data-ttu-id="e96a6-162">Die Standard Implementierung dieses Dienstanbieters, der von EF für alle Anbieter zurückgegeben wird, kann für einen bestimmten Datenbankserver funktionieren, wenn alle standardmäßigen Tabellen-und Spalten Zuordnungen von diesem Anbieter unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-162">The default implementation of this service returned by EF for all providers may work for a given database server if all the default table and column mappings are supported by that provider.</span></span> <span data-ttu-id="e96a6-163">In einem solchen Fall muss der Anbieter keine Implementierung dieses Dienstanbieters bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-163">In such a case the provider does not need to supply an implementation of this service.</span></span>

### <a name="idbproviderfactoryresolver"></a><span data-ttu-id="e96a6-164">Idbproviderfactor yresolver</span><span class="sxs-lookup"><span data-stu-id="e96a6-164">IDbProviderFactoryResolver</span></span>

<span data-ttu-id="e96a6-165">Dies ist ein optionaler Dienst zum Abrufen der richtigen DbProviderFactory aus einem bestimmten DbConnection-Objekt.</span><span class="sxs-lookup"><span data-stu-id="e96a6-165">This is an optional service for obtaining the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="e96a6-166">Die Standard Implementierung dieses diensdienstanbietern, der von EF für alle Anbieter zurückgegeben wird, ist für alle Anbieter vorgesehen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-166">The default implementation of this service returned by EF for all providers is intended to work for all providers.</span></span> <span data-ttu-id="e96a6-167">Bei der Ausführung unter .NET 4 ist die DbProviderFactory jedoch nicht öffentlich zugänglich, wenn die dbconnections-Verbindungen hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-167">However, when running on .NET 4, the DbProviderFactory is not publicly accessible from one if its DbConnections.</span></span> <span data-ttu-id="e96a6-168">Daher verwendet EF einige Heuristik, um die registrierten Anbieter zu suchen, um eine Entsprechung zu finden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-168">Therefore, EF uses some heuristics to search the registered providers to find a match.</span></span> <span data-ttu-id="e96a6-169">Es ist möglich, dass bei manchen Anbietern diese Heuristik fehlschlägt. in solchen Fällen sollte der Anbieter eine neue Implementierung bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-169">It is possible that for some providers these heuristics will fail and in such situations the provider should supply a new implementation.</span></span>

## <a name="registering-dbproviderservices"></a><span data-ttu-id="e96a6-170">Registrieren von DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="e96a6-170">Registering DbProviderServices</span></span>

<span data-ttu-id="e96a6-171">Die zu verwendende DbProviderServices-Implementierung kann entweder in der Konfigurationsdatei der Anwendung (app.config oder web.config) oder mithilfe der Code basierten Konfiguration registriert werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-171">The DbProviderServices implementation to use can be registered either in the application’s configuration file (app.config or web.config) or using code-based configuration.</span></span> <span data-ttu-id="e96a6-172">In beiden Fällen wird bei der Registrierung der invariante Name des Anbieters als Schlüssel verwendet.</span><span class="sxs-lookup"><span data-stu-id="e96a6-172">In either case the registration uses the provider’s “invariant name” as a key.</span></span> <span data-ttu-id="e96a6-173">Dadurch können mehrere Anbieter registriert und in einer einzigen Anwendung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-173">This allows multiple providers to be registered and used in a single application.</span></span> <span data-ttu-id="e96a6-174">Der für EF-Registrierungen verwendete invarianter Name ist identisch mit dem invarianten Namen, der für die ADO.NET-Anbieter Registrierung und Verbindungs Zeichenfolgen verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-174">The invariant name used for EF registrations is the same as the invariant name used for ADO.NET provider registration and connection strings.</span></span> <span data-ttu-id="e96a6-175">Beispielsweise wird für SQL Server der invariante Name "System. Data. SqlClient" verwendet.</span><span class="sxs-lookup"><span data-stu-id="e96a6-175">For example, for SQL Server the invariant name “System.Data.SqlClient” is used.</span></span>

### <a name="config-file-registration"></a><span data-ttu-id="e96a6-176">Registrierung über die Konfigurationsdatei</span><span class="sxs-lookup"><span data-stu-id="e96a6-176">Config file registration</span></span>

<span data-ttu-id="e96a6-177">Der zu verwendende DbProviderServices-Typ wird als Anbieter Element in der Anbieterliste des Abschnitts EntityFramework der Konfigurationsdatei der Anwendung registriert.</span><span class="sxs-lookup"><span data-stu-id="e96a6-177">The DbProviderServices type to use is registered as a provider element in the providers list of the entityFramework section of the application’s config file.</span></span> <span data-ttu-id="e96a6-178">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="e96a6-178">For example:</span></span>

``` xml
<entityFramework>
  <providers>
    <provider invariantName="My.Invariant.Name" type="MyProvider.MyProviderServices, MyAssembly" />
  </providers>
</entityFramework>
```

<span data-ttu-id="e96a6-179">Die _Typzeichenfolge_ muss der durch die Assembly qualifizierte Typname der zu verwendenden DbProviderServices-Implementierung sein.</span><span class="sxs-lookup"><span data-stu-id="e96a6-179">The _type_ string must be the assembly-qualified type name of the DbProviderServices implementation to use.</span></span>

### <a name="code-based-registration"></a><span data-ttu-id="e96a6-180">Codebasierte Registrierung</span><span class="sxs-lookup"><span data-stu-id="e96a6-180">Code-based registration</span></span>

<span data-ttu-id="e96a6-181">Beginnend mit EF6-Anbietern können auch mithilfe von Code registriert werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-181">Starting with EF6 providers can also be registered using code.</span></span> <span data-ttu-id="e96a6-182">Dadurch kann ein EF-Anbieter ohne Änderung an der Konfigurationsdatei der Anwendung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-182">This allows an EF provider to be used without any change to the application’s configuration file.</span></span> <span data-ttu-id="e96a6-183">Um die Code basierte Konfiguration zu verwenden, sollte eine Anwendung eine dbconfiguration-Klasse erstellen, wie in der [Dokumentation zur Code basierten Konfiguration](https://msdn.com/data/jj680699)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="e96a6-183">To use code-based configuration an application should create a DbConfiguration class as described in the [code-based configuration documentation](https://msdn.com/data/jj680699).</span></span> <span data-ttu-id="e96a6-184">Der Konstruktor der dbconfiguration-Klasse sollte dann setproviderservices aufrufen, um den EF-Anbieter zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="e96a6-184">The constructor of the DbConfiguration class should then call SetProviderServices to register the EF provider.</span></span> <span data-ttu-id="e96a6-185">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="e96a6-185">For example:</span></span>

``` csharp
public class MyConfiguration : DbConfiguration
{
    public MyConfiguration()
    {
        SetProviderServices("My.New.Provider", new MyProviderServices());
    }
}
```

## <a name="resolving-additional-services"></a><span data-ttu-id="e96a6-186">Auflösen zusätzlicher Dienste</span><span class="sxs-lookup"><span data-stu-id="e96a6-186">Resolving additional services</span></span>

<span data-ttu-id="e96a6-187">Wie oben im Abschnitt _Übersicht über Anbieter Typen_ erwähnt, kann eine DbProviderServices-Klasse auch zum Auflösen zusätzlicher Dienste verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-187">As mentioned above in the _Provider types overview_ section, a DbProviderServices class can also be used to resolve additional services.</span></span> <span data-ttu-id="e96a6-188">Dies ist möglich, weil DbProviderServices idbdependencyresolver implementiert und jeder registrierte DbProviderServices-Typ als "Standard Konflikt Löser" hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-188">This is possible because DbProviderServices implements IDbDependencyResolver and each registered DbProviderServices type is added as a “default resolver”.</span></span> <span data-ttu-id="e96a6-189">Der idbdpdencyresolver-Mechanismus wird in der [Abhängigkeitsauflösung](xref:ef6/fundamentals/configuring/dependency-resolution)ausführlicher beschrieben.</span><span class="sxs-lookup"><span data-stu-id="e96a6-189">The IDbDpendencyResolver mechanism is described in more detail in [Dependency Resolution](xref:ef6/fundamentals/configuring/dependency-resolution).</span></span> <span data-ttu-id="e96a6-190">Es ist jedoch nicht erforderlich, alle Konzepte in dieser Spezifikation zu verstehen, um zusätzliche Dienste in einem Anbieter aufzulösen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-190">However, it is not necessary to understand all the concepts in this specification to resolve additional services in a provider.</span></span>

<span data-ttu-id="e96a6-191">Die gängigste Methode für einen Anbieter, zusätzliche Dienste aufzulösen, besteht darin, DbProviderServices. adddependencyresolver für jeden Dienst im Konstruktor der DbProviderServices-Klasse aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-191">The most common way for a provider to resolve additional services is to call DbProviderServices.AddDependencyResolver for each service in the constructor of the DbProviderServices class.</span></span> <span data-ttu-id="e96a6-192">Sqlproviderservices (der EF-Anbieter für SQL Server) verfügt z. b. über Code, der diesem für die Initialisierung ähnelt:</span><span class="sxs-lookup"><span data-stu-id="e96a6-192">For example, SqlProviderServices (the EF provider for SQL Server) has code similar to this for initialization:</span></span>

``` csharp
private SqlProviderServices()
{
    AddDependencyResolver(new SingletonDependencyResolver<IDbConnectionFactory>(
        new SqlConnectionFactory()));

    AddDependencyResolver(new ExecutionStrategyResolver<DefaultSqlExecutionStrategy>(
        "System.data.SqlClient", null, () => new DefaultSqlExecutionStrategy()));

    AddDependencyResolver(new SingletonDependencyResolver<Func<MigrationSqlGenerator>>(
        () => new SqlServerMigrationSqlGenerator(), "System.data.SqlClient"));

    AddDependencyResolver(new SingletonDependencyResolver<DbSpatialServices>(
        SqlSpatialServices.Instance,
        k =>
        {
            var asSpatialKey = k as DbProviderInfo;
            return asSpatialKey == null
                || asSpatialKey.ProviderInvariantName == ProviderInvariantName;
        }));
}
```

<span data-ttu-id="e96a6-193">Dieser Konstruktor verwendet die folgenden Hilfsklassen:</span><span class="sxs-lookup"><span data-stu-id="e96a6-193">This constructor uses the following helper classes:</span></span>

*   <span data-ttu-id="e96a6-194">Singletondependencyresolver: bietet eine einfache Möglichkeit zum Auflösen von Singleton-Diensten – d. h. Dienste, für die bei jedem Aufruf von GetService dieselbe Instanz zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-194">SingletonDependencyResolver: provides a simple way to resolve Singleton services—that is, services for which the same instance is returned each time that GetService is called.</span></span> <span data-ttu-id="e96a6-195">Vorübergehende Dienste werden häufig als Singleton-Factory registriert, die zum bedarfsgesteuerten Erstellen vorübergehender Instanzen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-195">Transient services are often registered as a singleton factory that will be used to create transient instances on demand.</span></span>
*   <span data-ttu-id="e96a6-196">Executionstrategyresolver: ein Konflikt Löser, der spezifisch für die Rückgabe von iexecutionstrategy-Implementierungen ist.</span><span class="sxs-lookup"><span data-stu-id="e96a6-196">ExecutionStrategyResolver: a resolver specific to returning IExecutionStrategy implementations.</span></span>

<span data-ttu-id="e96a6-197">Anstatt DbProviderServices. adddependencyresolver zu verwenden, ist es auch möglich, DbProviderServices. GetService zu überschreiben und zusätzliche Dienste direkt aufzulösen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-197">Instead of using DbProviderServices.AddDependencyResolver it is also possible to override DbProviderServices.GetService and resolve additional services directly.</span></span> <span data-ttu-id="e96a6-198">Diese Methode wird aufgerufen, wenn EF einen Dienst benötigt, der durch einen bestimmten Typ definiert ist, und in manchen Fällen für einen bestimmten Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="e96a6-198">This method will be called when EF needs a service defined by a certain type and, in some cases, for a given key.</span></span> <span data-ttu-id="e96a6-199">Die-Methode sollte den Dienst zurückgeben, wenn dies möglich ist, oder NULL zurückgeben, um die Rückgabe des Dienstanbieter zu beenden und stattdessen einer anderen Klasse zu gestatten, diese zu beheben.</span><span class="sxs-lookup"><span data-stu-id="e96a6-199">The method should return the service if it can, or return null to opt-out of returning the service and instead allow another class to resolve it.</span></span> <span data-ttu-id="e96a6-200">Um beispielsweise die standardverbindungsfactory aufzulösen, könnte der Code in GetService etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="e96a6-200">For example, to resolve the default connection factory the code in GetService might look something like this:</span></span>

``` csharp
public override object GetService(Type type, object key)
{
    if (type == typeof(IDbConnectionFactory))
    {
        return new SqlConnectionFactory();
    }
    return null;
}
```

### <a name="registration-order"></a><span data-ttu-id="e96a6-201">Registrierungs Reihenfolge</span><span class="sxs-lookup"><span data-stu-id="e96a6-201">Registration order</span></span>

<span data-ttu-id="e96a6-202">Wenn mehrere DbProviderServices-Implementierungen in der Konfigurationsdatei einer Anwendung registriert werden, werden Sie als sekundäre Resolver in der Reihenfolge hinzugefügt, in der Sie aufgelistet sind.</span><span class="sxs-lookup"><span data-stu-id="e96a6-202">When multiple DbProviderServices implementations are registered in an application’s config file they will be added as secondary resolvers in the order that they are listed.</span></span> <span data-ttu-id="e96a6-203">Da Konflikt Löser immer am Anfang der sekundären resolverkette hinzugefügt werden, bedeutet dies, dass der Anbieter am Ende der Liste die Möglichkeit erhält, Abhängigkeiten vor den anderen aufzulösen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-203">Since resolvers are always added to the top of the secondary resolver chain this means that the provider at the end of the list will get a chance to resolve dependencies before the others.</span></span> <span data-ttu-id="e96a6-204">(Dies mag zunächst ein wenig intuitiv sein, aber es ist sinnvoll, wenn Sie sich vorstellen, dass die einzelnen Anbieter aus der Liste herausgenommen werden und Sie auf den vorhandenen Anbietern stapeln.)</span><span class="sxs-lookup"><span data-stu-id="e96a6-204">(This can seem a little counter-intuitive at first, but it makes sense if you imagine taking each provider out of the list and stacking it on top of the existing providers.)</span></span>

<span data-ttu-id="e96a6-205">Diese Reihenfolge spielt in der Regel keine Rolle, da die meisten Anbieter Dienste Anbieter spezifisch sind und nach Anbieter invarianter Namen verschlüsselt sind.</span><span class="sxs-lookup"><span data-stu-id="e96a6-205">This ordering usually doesn’t matter because most provider services are provider-specific and keyed by provider invariant name.</span></span> <span data-ttu-id="e96a6-206">Für Dienste, die nicht durch einen invarianten Anbieter Namen oder einen anderen anbieterspezifischen Schlüssel verschlüsselt sind, wird der Dienst jedoch basierend auf dieser Reihenfolge aufgelöst.</span><span class="sxs-lookup"><span data-stu-id="e96a6-206">However, for services that are not keyed by provider invariant name or some other provider-specific key the service will be resolved based on this ordering.</span></span> <span data-ttu-id="e96a6-207">Wenn Sie z. b. nicht explizit anders festgelegt wird, wird die standardverbindungsfactory von dem obersten Anbieter in der Kette abgeleitet.</span><span class="sxs-lookup"><span data-stu-id="e96a6-207">For example, if it is not explicitly set differently somewhere else, then the default connection factory will come from the topmost provider in the chain.</span></span>

## <a name="additional-config-file-registrations"></a><span data-ttu-id="e96a6-208">Weitere Registrierungen von Konfigurationsdateien</span><span class="sxs-lookup"><span data-stu-id="e96a6-208">Additional config file registrations</span></span>

<span data-ttu-id="e96a6-209">Es ist möglich, einige der oben beschriebenen zusätzlichen Anbieter Dienste direkt in der Konfigurationsdatei einer Anwendung zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="e96a6-209">It is possible to explicitly register some of the additional provider services described above directly in an application’s config file.</span></span> <span data-ttu-id="e96a6-210">Wenn dies erfolgt ist, wird die Registrierung in der Konfigurationsdatei anstelle der von der GetService-Methode der DbProviderServices-Implementierung zurückgegebenen Elemente verwendet.</span><span class="sxs-lookup"><span data-stu-id="e96a6-210">When this is done the registration in the config file will be used instead of anything returned by the GetService method of the DbProviderServices implementation.</span></span>

### <a name="registering-the-default-connection-factory"></a><span data-ttu-id="e96a6-211">Registrieren der standardverbindungsfactory</span><span class="sxs-lookup"><span data-stu-id="e96a6-211">Registering the default connection factory</span></span>

<span data-ttu-id="e96a6-212">Ab EF5 registriert das nuget-Paket "EntityFramework" automatisch entweder die SQL Express-Verbindungsfactory oder die localdb-Verbindungsfactory in der Konfigurationsdatei.</span><span class="sxs-lookup"><span data-stu-id="e96a6-212">Starting with EF5 the EntityFramework NuGet package automatically registered either the SQL Express connection factory or the LocalDb connection factory in the config file.</span></span>

<span data-ttu-id="e96a6-213">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="e96a6-213">For example:</span></span>

``` xml
<entityFramework>
  <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" >
</entityFramework>
```

<span data-ttu-id="e96a6-214">Der _Typ_ ist der durch die Assembly qualifizierte Typname für die standardverbindungsfactory, die idbconnectionfactory implementieren muss.</span><span class="sxs-lookup"><span data-stu-id="e96a6-214">The _type_ is the assembly-qualified type name for the default connection factory, which must implement IDbConnectionFactory.</span></span>

<span data-ttu-id="e96a6-215">Es wird empfohlen, dass das nuget-Paket eines Anbieters die standardverbindungsfactory bei der Installation auf diese Weise festgelegt.</span><span class="sxs-lookup"><span data-stu-id="e96a6-215">It is recommended that a provider NuGet package set the default connection factory in this way when installed.</span></span> <span data-ttu-id="e96a6-216">Siehe _nuget-Pakete für Anbieter_ weiter unten.</span><span class="sxs-lookup"><span data-stu-id="e96a6-216">See _NuGet Packages for providers_ below.</span></span>

## <a name="additional-ef6-provider-changes"></a><span data-ttu-id="e96a6-217">Zusätzliche EF6-Anbieter Änderungen</span><span class="sxs-lookup"><span data-stu-id="e96a6-217">Additional EF6 provider changes</span></span>

### <a name="spatial-provider-changes"></a><span data-ttu-id="e96a6-218">Änderungen an räumlichen Anbietern</span><span class="sxs-lookup"><span data-stu-id="e96a6-218">Spatial provider changes</span></span>

<span data-ttu-id="e96a6-219">Anbieter, die räumliche Typen unterstützen, müssen jetzt einige zusätzliche Methoden für Klassen implementieren, die von dbspatialdatareader abgeleitet werden:</span><span class="sxs-lookup"><span data-stu-id="e96a6-219">Providers that support spatial types must now implement some additional methods on classes deriving from DbSpatialDataReader:</span></span>

*   `public abstract bool IsGeographyColumn(int ordinal)`
*   `public abstract bool IsGeometryColumn(int ordinal)`

<span data-ttu-id="e96a6-220">Es gibt auch neue asynchrone Versionen vorhandener Methoden, die überschrieben werden sollen, wenn der standardimplementierungs Delegat an die synchronen Methoden delegiert und daher nicht asynchron ausgeführt wird:</span><span class="sxs-lookup"><span data-stu-id="e96a6-220">There are also new asynchronous versions of existing methods that are recommended to be overridden as the default implementations delegate to the synchronous methods and therefore do not execute asynchronously:</span></span>

*   `public virtual Task<DbGeography> GetGeographyAsync(int ordinal, CancellationToken cancellationToken)`
*   `public virtual Task<DbGeometry> GetGeometryAsync(int ordinal, CancellationToken cancellationToken)`

### <a name="native-support-for-enumerablecontains"></a><span data-ttu-id="e96a6-221">Native Unterstützung für Enumerable. enthält</span><span class="sxs-lookup"><span data-stu-id="e96a6-221">Native support for Enumerable.Contains</span></span>

<span data-ttu-id="e96a6-222">EF6 führt den neuen Ausdruckstyp dbinexpression ein, der hinzugefügt wurde, um Leistungsprobleme im Zusammenhang mit der Verwendung von Enumerable zu beheben. enthält in LINQ-Abfragen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-222">EF6 introduces a new expression type, DbInExpression, which was added to address performance issues around use of Enumerable.Contains in LINQ queries.</span></span> <span data-ttu-id="e96a6-223">Die DbProviderManifest-Klasse verfügt über die neue virtuelle Methode supportsinexpression, die von EF aufgerufen wird, um zu bestimmen, ob ein Anbieter den neuen Ausdruckstyp behandelt.</span><span class="sxs-lookup"><span data-stu-id="e96a6-223">The DbProviderManifest class has a new virtual method, SupportsInExpression, which is called by EF to determine if a provider handles the new expression type.</span></span> <span data-ttu-id="e96a6-224">Aus Kompatibilitätsgründen mit vorhandenen Anbieter Implementierungen gibt die Methode false zurück.</span><span class="sxs-lookup"><span data-stu-id="e96a6-224">For compatibility with existing provider implementations the method returns false.</span></span> <span data-ttu-id="e96a6-225">Um von dieser Verbesserung profitieren zu können, kann ein EF6-Anbieter Code hinzufügen, der dbinexpression verarbeitet und supportsinexpression überschreibt, um true zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="e96a6-225">To benefit from this improvement, an EF6 provider can add code to handle DbInExpression and override SupportsInExpression to return true.</span></span> <span data-ttu-id="e96a6-226">Eine Instanz von dbinexpression kann erstellt werden, indem die DbExpressionBuilder.in-Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-226">An instance of DbInExpression can be created by calling the DbExpressionBuilder.In method.</span></span> <span data-ttu-id="e96a6-227">Eine dbinexpression-Instanz besteht aus einem DbExpression, der in der Regel eine Tabellenspalte darstellt, und einer Liste von DbConstantExpression, die auf eine Entsprechung überprüft werden soll.</span><span class="sxs-lookup"><span data-stu-id="e96a6-227">A DbInExpression instance is composed of a DbExpression, usually representing a table column, and a list of DbConstantExpression to test for a match.</span></span>

## <a name="nuget-packages-for-providers"></a><span data-ttu-id="e96a6-228">Nuget-Pakete für Anbieter</span><span class="sxs-lookup"><span data-stu-id="e96a6-228">NuGet packages for providers</span></span>

<span data-ttu-id="e96a6-229">Eine Möglichkeit, einen EF6-Anbieter verfügbar zu machen, besteht darin, ihn als nuget-Paket freizugeben.</span><span class="sxs-lookup"><span data-stu-id="e96a6-229">One way to make an EF6 provider available is to release it as a NuGet package.</span></span> <span data-ttu-id="e96a6-230">Die Verwendung eines nuget-Pakets bietet folgende Vorteile:</span><span class="sxs-lookup"><span data-stu-id="e96a6-230">Using a NuGet package has the following advantages:</span></span>

*   <span data-ttu-id="e96a6-231">Es ist einfach, nuget zu verwenden, um die Anbieter Registrierung zur Konfigurationsdatei der Anwendung hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-231">It is easy to use NuGet to add the provider registration to the application’s config file</span></span>
*   <span data-ttu-id="e96a6-232">Es können zusätzliche Änderungen an der Konfigurationsdatei vorgenommen werden, um die standardverbindungsfactory festzulegen, damit von der Konvention hergestellte Verbindungen der registrierte Anbieter verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-232">Additional changes can be made to the config file to set the default connection factory so that connections made by convention will use the registered provider</span></span>
*   <span data-ttu-id="e96a6-233">Nuget übernimmt das Hinzufügen von Bindungs Umleitungen, sodass der EF6-Anbieter auch nach der Veröffentlichung eines neuen EF-Pakets weiterhin funktionieren sollte.</span><span class="sxs-lookup"><span data-stu-id="e96a6-233">NuGet handles adding binding redirects so that the EF6 provider should continue to work even after a new EF package is released</span></span>

<span data-ttu-id="e96a6-234">Ein Beispiel hierfür ist das Paket "EntityFramework. sqlservercompact", das in der [Open Source-Codebasis](https://github.com/aspnet/entityframework6)enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="e96a6-234">An example of this is the EntityFramework.SqlServerCompact package which is included in the [open source codebase](https://github.com/aspnet/entityframework6).</span></span> <span data-ttu-id="e96a6-235">Dieses Paket bietet eine gute Vorlage zum Erstellen von nuget-Paketen für EF-Anbieter.</span><span class="sxs-lookup"><span data-stu-id="e96a6-235">This package provides a good template for creating EF provider NuGet packages.</span></span>

### <a name="powershell-commands"></a><span data-ttu-id="e96a6-236">PowerShell-Befehle</span><span class="sxs-lookup"><span data-stu-id="e96a6-236">PowerShell commands</span></span>

<span data-ttu-id="e96a6-237">Wenn das nuget-Paket "EntityFramework" installiert ist, wird ein PowerShell-Modul registriert, das zwei Befehle enthält, die für Anbieter Pakete sehr nützlich sind:</span><span class="sxs-lookup"><span data-stu-id="e96a6-237">When the EntityFramework NuGet package is installed it registers a PowerShell module that contains two commands that are very useful for provider packages:</span></span>

*   <span data-ttu-id="e96a6-238">Add-efprovider fügt eine neue Entität für den Anbieter in der Konfigurationsdatei des Ziel Projekts hinzu und stellt sicher, dass Sie sich am Ende der Liste registrierter Anbieter befindet.</span><span class="sxs-lookup"><span data-stu-id="e96a6-238">Add-EFProvider adds a new entity for the provider in the target project’s configuration file and makes sure it is at the end of the list of registered providers.</span></span>
*   <span data-ttu-id="e96a6-239">Add-efdefaultconnectionfactory fügt entweder die defaultconnectionfactory-Registrierung in der Konfigurationsdatei des Ziel Projekts hinzu oder aktualisiert sie.</span><span class="sxs-lookup"><span data-stu-id="e96a6-239">Add-EFDefaultConnectionFactory either adds or updates the defaultConnectionFactory registration in the target project’s configuration file.</span></span>

<span data-ttu-id="e96a6-240">Beide Befehle kümmern sich um die Hinzufügung eines EntityFramework-Abschnitts zur Konfigurationsdatei und das Hinzufügen einer Anbieter Auflistung, falls erforderlich.</span><span class="sxs-lookup"><span data-stu-id="e96a6-240">Both these commands take care of adding an entityFramework section to the config file and adding a providers collection if necessary.</span></span>

<span data-ttu-id="e96a6-241">Es ist vorgesehen, dass diese Befehle vom install.ps1 nuget-Skript aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-241">It is intended that these commands be called from the install.ps1 NuGet script.</span></span> <span data-ttu-id="e96a6-242">install.ps1 für den SQL Compact-Anbieter sieht z. b. wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="e96a6-242">For example, install.ps1 for the SQL Compact provider looks similar to this:</span></span>

``` powershell
param($installPath, $toolsPath, $package, $project)
Add-EFDefaultConnectionFactory $project 'System.Data.Entity.Infrastructure.SqlCeConnectionFactory, EntityFramework' -ConstructorArguments 'System.Data.SqlServerCe.4.0'
Add-EFProvider $project 'System.Data.SqlServerCe.4.0' 'System.Data.Entity.SqlServerCompact.SqlCeProviderServices, EntityFramework.SqlServerCompact'</pre>
```

<span data-ttu-id="e96a6-243">Weitere Informationen zu diesen Befehlen finden Sie unter Verwenden von "Get-Help" im Fenster "Paket-Manager-Konsole".</span><span class="sxs-lookup"><span data-stu-id="e96a6-243">More information about these commands can be obtained by using get-help in the Package Manager Console window.</span></span>

## <a name="wrapping-providers"></a><span data-ttu-id="e96a6-244">Umwickeln von Anbietern</span><span class="sxs-lookup"><span data-stu-id="e96a6-244">Wrapping providers</span></span>

<span data-ttu-id="e96a6-245">Ein Wrapping Anbieter ist ein EF-und/oder ADO.NET-Anbieter, der einen vorhandenen Anbieter umschließt, um ihn mit anderen Funktionen wie Profilerstellung oder Ablauf Verfolgungs Funktionen zu erweitern.</span><span class="sxs-lookup"><span data-stu-id="e96a6-245">A wrapping provider is an EF and/or ADO.NET provider that wraps an existing provider to extend it with other functionality such as profiling or tracing capabilities.</span></span> <span data-ttu-id="e96a6-246">Das Umbrechen von Anbietern kann auf normale Weise registriert werden. es ist jedoch oft bequemer, den Wrapping Anbieter zur Laufzeit zu erstellen, indem die Auflösung von Anbieter bezogenen Diensten abgefangen wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-246">Wrapping providers can be registered in the normal way, but it is often more convenient to setup the wrapping provider at runtime by intercepting the resolution of provider-related services.</span></span> <span data-ttu-id="e96a6-247">Dazu kann das statische Ereignis onlockingconfiguration in der dbconfiguration-Klasse verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-247">The static event OnLockingConfiguration on the DbConfiguration class can be used to do this.</span></span>

<span data-ttu-id="e96a6-248">"Onlockingconfiguration" wird aufgerufen, nachdem EF festgelegt hat, wo alle EF-Konfigurationen für die APP-Domäne abgerufen werden, aber bevor Sie für die Verwendung gesperrt sind.</span><span class="sxs-lookup"><span data-stu-id="e96a6-248">OnLockingConfiguration is called after EF has determined where all EF configuration for the app domain will be obtained from but before it is locked for use.</span></span> <span data-ttu-id="e96a6-249">Beim Starten der APP (vor der Verwendung von EF) sollte die APP einen Ereignishandler für dieses Ereignis registrieren.</span><span class="sxs-lookup"><span data-stu-id="e96a6-249">At app startup (before EF is used) the app should register an event handler for this event.</span></span> <span data-ttu-id="e96a6-250">(Unterstützung für das Registrieren dieses Handlers in der Konfigurationsdatei wird in Erwägung gezogen, aber dies wird noch nicht unterstützt.) Der Ereignishandler sollte dann den replaceservice für jeden Dienst aufrufen, der umschließen werden muss.</span><span class="sxs-lookup"><span data-stu-id="e96a6-250">(We are considering adding support for registering this handler in the config file but this is not yet supported.) The event handler should then make a call to ReplaceService for every service that needs to be wrapped.</span></span>  

<span data-ttu-id="e96a6-251">Um beispielsweise idbconnectionfactory und dbproviderservice zu wrappen, sollte ein Handler ähnlich dem folgenden registriert werden:</span><span class="sxs-lookup"><span data-stu-id="e96a6-251">For example, to wrap IDbConnectionFactory and DbProviderService, a handler something like this should be registered:</span></span>

``` csharp
DbConfiguration.OnLockingConfiguration +=
    (_, a) =>
    {
        a.ReplaceService<DbProviderServices>(
            (s, k) => new MyWrappedProviderServices(s));

        a.ReplaceService<IDbConnectionFactory>(
            (s, k) => new MyWrappedConnectionFactory(s));
    };
```

<span data-ttu-id="e96a6-252">Der Dienst, der aufgelöst wurde und nun mit dem Schlüssel umschließt werden soll, mit dem der Dienst aufgelöst wurde, wird an den-Handler übermittelt.</span><span class="sxs-lookup"><span data-stu-id="e96a6-252">The service that has been resolved and should now be wrapped together with the key that was used to resolve the service are passed to the handler.</span></span> <span data-ttu-id="e96a6-253">Der Handler kann dann diesen Dienst umschließen und den zurückgegebenen Dienst durch die umschließende Version ersetzen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-253">The handler can then wrap this service and replace the returned service with the wrapped version.</span></span>

## <a name="resolving-a-dbproviderfactory-with-ef"></a><span data-ttu-id="e96a6-254">Auflösen einer DbProviderFactory mit EF</span><span class="sxs-lookup"><span data-stu-id="e96a6-254">Resolving a DbProviderFactory with EF</span></span>

<span data-ttu-id="e96a6-255">DbProviderFactory ist einer der grundlegenden Anbieter Typen, der von EF benötigt wird, wie im Abschnitt Übersicht über die _Anbieter Typen_ beschrieben.</span><span class="sxs-lookup"><span data-stu-id="e96a6-255">DbProviderFactory is one of the fundamental provider types needed by EF as described in the _Provider types overview_ section above.</span></span> <span data-ttu-id="e96a6-256">Wie bereits erwähnt, handelt es sich nicht um einen EF-Typ, und die Registrierung ist normalerweise nicht Teil der EF-Konfiguration, sondern ist stattdessen die normale ADO.NET-Anbieter Registrierung in der machine.config Datei und/oder der Anwendungs Konfigurationsdatei.</span><span class="sxs-lookup"><span data-stu-id="e96a6-256">As already mentioned, It is not an EF type and registration is usually not part of EF configuration, but is instead the normal ADO.NET provider registration in the machine.config file and/or application’s config file.</span></span>

<span data-ttu-id="e96a6-257">Trotz dieses EF verwendet EF weiterhin seinen normalen Mechanismus zur Abhängigkeitsauflösung, wenn eine DbProviderFactory verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="e96a6-257">Despite this EF still uses its normal dependency resolution mechanism when looking for a DbProviderFactory to use.</span></span> <span data-ttu-id="e96a6-258">Der Standard Konflikt Löser verwendet die normale ADO.net-Registrierung in den Konfigurationsdateien und ist daher normalerweise transparent.</span><span class="sxs-lookup"><span data-stu-id="e96a6-258">The default resolver uses the normal ADO.NET registration in the config files and so this is usually transparent.</span></span> <span data-ttu-id="e96a6-259">Aufgrund des normalen Mechanismus zur Abhängigkeitsauflösung bedeutet dies jedoch, dass ein idbdependencyresolver verwendet werden kann, um eine DbProviderFactory aufzulösen, auch wenn die normale ADO.net-Registrierung nicht durchgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="e96a6-259">But because of the normal dependency resolution mechanism is used it means that an IDbDependencyResolver can be used to resolve a DbProviderFactory even when normal ADO.NET registration has not been done.</span></span>

<span data-ttu-id="e96a6-260">Das Auflösen von DbProviderFactory auf diese Weise hat mehrere Auswirkungen:</span><span class="sxs-lookup"><span data-stu-id="e96a6-260">Resolving DbProviderFactory in this way has several implications:</span></span>

*   <span data-ttu-id="e96a6-261">Eine Anwendung, die die Code basierte Konfiguration verwendet, kann Aufrufe in ihrer dbconfiguration-Klasse hinzufügen, um die entsprechende DbProviderFactory zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="e96a6-261">An application using code-based configuration can add calls in their DbConfiguration class to register the appropriate DbProviderFactory.</span></span> <span data-ttu-id="e96a6-262">Dies ist besonders nützlich für Anwendungen, die keine dateibasierte Konfiguration verwenden möchten (oder nicht).</span><span class="sxs-lookup"><span data-stu-id="e96a6-262">This is especially useful for applications that do not want to (or cannot) make use of any file-based configuration at all.</span></span>
*   <span data-ttu-id="e96a6-263">Der Dienst kann mithilfe von replaceservice umschließt oder ersetzt werden, wie im Abschnitt _Wrapping Anbieter_ beschrieben.</span><span class="sxs-lookup"><span data-stu-id="e96a6-263">The service can be wrapped or replaced using ReplaceService as described in the _Wrapping providers_ section above</span></span>
*   <span data-ttu-id="e96a6-264">Theoretisch könnte eine DbProviderServices-Implementierung eine DbProviderFactory auflösen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-264">Theoretically, a DbProviderServices implementation could resolve a DbProviderFactory.</span></span>

<span data-ttu-id="e96a6-265">Beachten Sie, dass sich diese Dinge unbedingt auf die Suche von DbProviderFactory durch EF auswirken.</span><span class="sxs-lookup"><span data-stu-id="e96a6-265">The important point to note about doing any of these things is that they will only affect the lookup of DbProviderFactory by EF.</span></span> <span data-ttu-id="e96a6-266">Anderer nicht-EF-Code erwartet möglicherweise weiterhin, dass der ADO.NET-Anbieter auf normale Weise registriert wird, und schlägt möglicherweise fehl, wenn die Registrierung nicht gefunden wurde.</span><span class="sxs-lookup"><span data-stu-id="e96a6-266">Other non-EF code may still expect the ADO.NET provider to be registered in the normal way and may fail if the registration is not found.</span></span> <span data-ttu-id="e96a6-267">Aus diesem Grund ist es normalerweise besser, eine DbProviderFactory auf normale Weise zu registrieren ADO.net.</span><span class="sxs-lookup"><span data-stu-id="e96a6-267">For this reason it is normally better for a DbProviderFactory to be registered in the normal ADO.NET way.</span></span>

### <a name="related-services"></a><span data-ttu-id="e96a6-268">Verknüpfte Dienste</span><span class="sxs-lookup"><span data-stu-id="e96a6-268">Related services</span></span>

<span data-ttu-id="e96a6-269">Wenn EF verwendet wird, um eine DbProviderFactory aufzulösen, sollte Sie auch die iproviderinvariantname-und idbproviderfactor yresolver-Dienste auflösen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-269">If EF is used to resolve a DbProviderFactory, then it should also resolve the IProviderInvariantName and IDbProviderFactoryResolver services.</span></span>

<span data-ttu-id="e96a6-270">Iproviderinvariantname ist ein Dienst, der verwendet wird, um einen invarianten Anbieter Namen für einen bestimmten Typ von DbProviderFactory zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="e96a6-270">IProviderInvariantName is a service that is used to determine a provider invariant name for a given type of DbProviderFactory.</span></span> <span data-ttu-id="e96a6-271">Die Standard Implementierung dieses Dienstanbieters verwendet die ADO.NET-Anbieter Registrierung.</span><span class="sxs-lookup"><span data-stu-id="e96a6-271">The default implementation of this service uses the ADO.NET provider registration.</span></span> <span data-ttu-id="e96a6-272">Dies bedeutet Folgendes: Wenn der ADO.NET-Anbieter nicht auf die normale Weise registriert ist, weil DbProviderFactory von EF aufgelöst wird, muss dieser Dienst ebenfalls aufgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-272">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span> <span data-ttu-id="e96a6-273">Beachten Sie, dass ein Konflikt Löser für diesen Dienst automatisch hinzugefügt wird, wenn die dbconfiguration. setproviderfactory-Methode verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="e96a6-273">Note that a resolver for this service is automatically added when using the DbConfiguration.SetProviderFactory method.</span></span>

<span data-ttu-id="e96a6-274">Wie im Abschnitt Übersicht über die _Anbieter Typen_ beschrieben, wird der idbproviderfactoryresolver verwendet, um die korrekte DbProviderFactory aus einem bestimmten DbConnection-Objekt abzurufen.</span><span class="sxs-lookup"><span data-stu-id="e96a6-274">As described in the _Provider types overview_ section above, the IDbProviderFactoryResolver is used to obtain the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="e96a6-275">Die Standard Implementierung dieses Dienstanbieters bei Ausführung auf .NET 4 verwendet die ADO.NET-Anbieter Registrierung.</span><span class="sxs-lookup"><span data-stu-id="e96a6-275">The default implementation of this service when running on .NET 4 uses the ADO.NET provider registration.</span></span> <span data-ttu-id="e96a6-276">Dies bedeutet Folgendes: Wenn der ADO.NET-Anbieter nicht auf die normale Weise registriert ist, weil DbProviderFactory von EF aufgelöst wird, muss dieser Dienst ebenfalls aufgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="e96a6-276">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span>
