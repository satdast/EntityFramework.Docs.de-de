---
title: Leistungs Diagnose-EF Core
description: Diagnostizieren Entity Framework Core Leistung und Identifizieren von Engpässen
author: roji
ms.date: 12/1/2020
uid: core/performance/performance-diagnosis
ms.openlocfilehash: 9416acf3326056ef7a5d732c4bd456dac751167b
ms.sourcegitcommit: 4860d036ea0fb392c28799907bcc924c987d2d7b
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/17/2020
ms.locfileid: "97657713"
---
# <a name="performance-diagnosis"></a><span data-ttu-id="f3f5a-103">Leistungs Diagnose</span><span class="sxs-lookup"><span data-stu-id="f3f5a-103">Performance Diagnosis</span></span>

<span data-ttu-id="f3f5a-104">In diesem Abschnitt wird erläutert, wie Sie Leistungsprobleme in ihrer EF-Anwendung erkennen. Nachdem ein problematischer Bereich identifiziert wurde, können Sie diese weiter analysieren, um das Problem zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-104">This section discusses ways for detecting performance issues in your EF application, and once a problematic area has been identified, how to further analyze them to identify the root problem.</span></span> <span data-ttu-id="f3f5a-105">Es ist wichtig, alle Probleme sorgfältig zu diagnostizieren und zu untersuchen, bevor Sie zu den Schlussfolgerungen springen, und um zu vermeiden, dass die Ursache des Problems ist.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-105">It's important to carefully diagnose and investigate any problems before jumping to any conclusions, and to avoid assuming where the root of the issue is.</span></span>

## <a name="identifying-slow-database-commands-via-logging"></a><span data-ttu-id="f3f5a-106">Identifizieren langsamer Daten Bank Befehle über die Protokollierung</span><span class="sxs-lookup"><span data-stu-id="f3f5a-106">Identifying slow database commands via logging</span></span>

<span data-ttu-id="f3f5a-107">Am Ende des Tages werden von EF die Befehle vorbereitet und ausgeführt, die für die Datenbank ausgeführt werden. bei relationalen Datenbanken bedeutet das, SQL-Anweisungen über die ADO.net-Datenbank-API auszuführen.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-107">At the end of the day, EF prepares and executes commands to be executed against your database; with relational database, that means executing SQL statements via the ADO.NET database API.</span></span> <span data-ttu-id="f3f5a-108">Wenn eine bestimmte Abfrage zu viel Zeit in Anspruch nimmt (z. b. weil ein Index fehlt), kann dies erkannt werden, indem die Befehle zur Befehlsausführung überprüft werden und Sie beobachten, wie lange Sie tatsächlich dauern.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-108">If a certain query is taking too much time (e.g. because an index is missing), this can be seen discovered by inspecting command execution logs and observing how long they actually take.</span></span>

<span data-ttu-id="f3f5a-109">EF vereinfacht das Erfassen von Ausführungszeiten von Befehlen sehr einfach über [einfache Protokollierung](xref:core/logging-events-diagnostics/simple-logging) oder [Microsoft. Extensions. Logging](xref:core/logging-events-diagnostics/extensions-logging):</span><span class="sxs-lookup"><span data-stu-id="f3f5a-109">EF makes it very easy to capture command execution times, via either [simple logging](xref:core/logging-events-diagnostics/simple-logging) or [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging):</span></span>

### <a name="simple-logging"></a>[<span data-ttu-id="f3f5a-110">Einfache Protokollierung</span><span class="sxs-lookup"><span data-stu-id="f3f5a-110">Simple logging</span></span>](#tab/simple-logging)

[!code-csharp[Main](../../../samples/core/Performance/BloggingContext.cs#SimpleLogging)]

### <a name="microsoftextensionslogging"></a>[<span data-ttu-id="f3f5a-111">Microsoft.Extensions.Logging</span><span class="sxs-lookup"><span data-stu-id="f3f5a-111">Microsoft.Extensions.Logging</span></span>](#tab/microsoft-extensions-logging)

[!code-csharp[Main](../../../samples/core/Performance/ExtensionsLoggingContext.cs#ExtensionsLogging)]

***

<span data-ttu-id="f3f5a-112">Wenn der Protokolliergrad auf festgelegt ist `LogLevel.Information` , gibt EF eine Protokollmeldung für jede Befehlsausführung mit der folgenden Zeit aus:</span><span class="sxs-lookup"><span data-stu-id="f3f5a-112">When the logging level is set at `LogLevel.Information`, EF emits a log message for each command execution with the time taken:</span></span>

```log
info: 06/12/2020 09:12:36.117 RelationalEventId.CommandExecuted[20101] (Microsoft.EntityFrameworkCore.Database.Command)
      Executed DbCommand (4ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT [b].[Id], [b].[Name]
      FROM [Blogs] AS [b]
      WHERE [b].[Name] = N'foo'
```

<span data-ttu-id="f3f5a-113">Der obige Befehl hat 4 Millisekunden gedauert.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-113">The above command took 4 milliseconds.</span></span> <span data-ttu-id="f3f5a-114">Wenn ein bestimmter Befehl mehr als erwartet erfordert, haben Sie einen möglichen Fehler bei einem Leistungsproblem festgestellt und können sich nun darauf konzentrieren, um zu verstehen, warum er langsam ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-114">If a certain command takes more than expected, you've found a possible culprit for a performance issue, and can now focus on it to understand why it's running slowly.</span></span> <span data-ttu-id="f3f5a-115">Die Befehls Protokollierung kann auch Fälle anzeigen, in denen unerwartete Datenbankroundtrips durchgeführt werden. Dies würde als mehrere Befehle angezeigt werden, bei denen nur eine erwartet wird.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-115">Command logging can also reveal cases where unexpected database roundtrips are being made; this would show up as multiple commands where only one is expected.</span></span>

> [!WARNING]
> <span data-ttu-id="f3f5a-116">Es ist in der Regel eine gute Idee, die Protokollierung der Befehlsausführung in der Produktionsumgebung zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-116">Leaving command execution logging enabled in your production environment is usually a bad idea.</span></span> <span data-ttu-id="f3f5a-117">Die Protokollierung selbst verlangsamt Ihre Anwendung und kann schnell sehr große Protokolldateien erstellen, die den Datenträger des Servers auffüllen können.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-117">The logging itself slows down your application, and may quickly create huge log files which can fill up your server's disk.</span></span> <span data-ttu-id="f3f5a-118">Es wird empfohlen, sich nur für ein kurzes Zeitintervall anzumelden, um Daten zu sammeln, während Sie Ihre Anwendung sorgfältig überwachen oder Protokollierungs Daten auf einem präproduktionssystem erfassen.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-118">It's recommended to only keep logging on for a short interval of time to gather data - while carefully monitoring your application - or to capture logging data on a pre-production system.</span></span>

## <a name="correlating-database-commands-to-linq-queries"></a><span data-ttu-id="f3f5a-119">Korrelieren von Daten Bank Befehlen mit LINQ-Abfragen</span><span class="sxs-lookup"><span data-stu-id="f3f5a-119">Correlating database commands to LINQ queries</span></span>

<span data-ttu-id="f3f5a-120">Ein Problem bei der Protokollierung der Befehlsausführung ist, dass es manchmal schwierig ist, SQL-Abfragen und LINQ-Abfragen zu korrelieren: die von EF ausgeführten SQL-Befehle können sich von den LINQ-Abfragen unterscheiden, von denen Sie generiert wurden.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-120">One problem with command execution logging is that it's sometimes difficult to correlate SQL queries and LINQ queries: the SQL commands executed by EF can look very different from the LINQ queries from which they were generated.</span></span> <span data-ttu-id="f3f5a-121">Zur Unterstützung dieser Schwierigkeit empfiehlt es sich, das Feature " [Abfrage Tags](xref:core/querying/tags) " von EF zu verwenden, mit dem Sie einen kleinen, identifizierenden Kommentar in die SQL-Abfrage einfügen können:</span><span class="sxs-lookup"><span data-stu-id="f3f5a-121">To help with this difficulty, you may want to use EF's [query tags](xref:core/querying/tags) feature, which allows you to inject a small, identifying comment into the SQL query:</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tags/Program.cs#BasicQueryTag)]

<span data-ttu-id="f3f5a-122">Das Tag wird in den Protokollen angezeigt:</span><span class="sxs-lookup"><span data-stu-id="f3f5a-122">The tag shows up in the logs:</span></span>

```sql
-- This is my spatial query!

SELECT TOP(@__p_1) [p].[Id], [p].[Location]
FROM [People] AS [p]
ORDER BY [p].[Location].STDistance(@__myLocation_0) DESC
```

<span data-ttu-id="f3f5a-123">Häufig ist es sinnvoll, die wichtigsten Abfragen einer Anwendung auf diese Weise zu markieren, damit die Befehlsausführung die Protokolle schneller lesbar wird.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-123">It's often worth tagging the major queries of an application in this way, to make the command execution logs more immediately readable.</span></span>

## <a name="other-interfaces-for-capturing-performance-data"></a><span data-ttu-id="f3f5a-124">Weitere Schnittstellen zur Erfassung von Leistungsdaten</span><span class="sxs-lookup"><span data-stu-id="f3f5a-124">Other interfaces for capturing performance data</span></span>

<span data-ttu-id="f3f5a-125">Es gibt verschiedene Alternativen zum Protokollierungs Feature von EF zum Erfassen von Ausführungszeiten von Befehlen, die möglicherweise leistungsfähiger sind.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-125">There are various alternatives to EF's logging feature for capturing command execution times, which may be more powerful.</span></span> <span data-ttu-id="f3f5a-126">Datenbanken verfügen in der Regel über eigene Ablaufverfolgungs-und Leistungsanalyse Tools, die in der Regel umfangreichere, datenbankspezifische Informationen über einfache Ausführungszeiten bereitstellen. die tatsächliche Einrichtung, die Funktionen und die Verwendung variieren in den Datenbanken erheblich.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-126">Databases typically come with their own tracing and performance analysis tools, which usually provide much richer, database-specific information beyond simple execution times; the actual setup, capabilities and usage vary considerably across databases.</span></span>

<span data-ttu-id="f3f5a-127">[SQL Server Management Studio](/sql/ssms/download-sql-server-management-studio-ssms) ist beispielsweise ein leistungsfähiger Client, der eine Verbindung mit Ihrer SQL Server Instanz herstellen und wertvolle Verwaltungs-und Leistungsinformationen bereitstellen kann.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-127">For example, [SQL Server Management Studio](/sql/ssms/download-sql-server-management-studio-ssms) is a powerful client that can connect to your SQL Server  instance and provide valuable management and performance information.</span></span> <span data-ttu-id="f3f5a-128">Es geht über den Rahmen dieses Abschnitts hinaus, die Details zu überschreiten, aber zwei zu beachnende Funktionen sind der [Aktivitäts Monitor](/sql/relational-databases/performance-monitor/open-activity-monitor-sql-server-management-studio), der ein Live-Dashboard der Serveraktivität (einschließlich der teuersten Abfragen) und das Feature für [Erweiterte Ereignisse (XEvent)](/sql/relational-databases/extended-events/quick-start-extended-events-in-sql-server) bereitstellt, mit dem Sie beliebige Daten Erfassungs Sitzungen definieren können, die auf ihre exakten Anforderungen zugeschnitten sind.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-128">It's beyond the scope of this section to go into the details, but two capabilities worth mentioning are the [Activity Monitor](/sql/relational-databases/performance-monitor/open-activity-monitor-sql-server-management-studio), which provides a live dashboard of server activity (including the most expensive queries), and the [Extended Events (XEvent)](/sql/relational-databases/extended-events/quick-start-extended-events-in-sql-server) feature, which allows defining arbitrary data capture sessions which can be tailored to your exact needs.</span></span> <span data-ttu-id="f3f5a-129">In [der SQL Server Dokumentation zur Überwachung](/sql/relational-databases/performance/monitor-and-tune-for-performance) finden Sie weitere Informationen zu diesen Features und anderen.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-129">[The SQL Server documentation on monitoring](/sql/relational-databases/performance/monitor-and-tune-for-performance) provides more information on these features, as well as others.</span></span>

<span data-ttu-id="f3f5a-130">Ein weiterer Ansatz zur Erfassung von Leistungsdaten ist die Erfassung von Informationen, die entweder von EF oder dem Datenbanktreiber über die- `DiagnosticSource` Schnittstelle automatisch ausgegeben werden, und dann die Analyse dieser Daten oder die Anzeige auf einem Dashboard.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-130">Another approach for capturing performance data is to collect information automatically emitted by either EF or the database driver via the `DiagnosticSource` interface, and then analyze that data or display it on a dashboard.</span></span> <span data-ttu-id="f3f5a-131">Wenn Sie Azure verwenden, bietet [Azure-Anwendung Insights](https://docs.microsoft.com/azure/azure-monitor/learn/tutorial-performance) standardmäßig eine solche leistungsfähige Überwachung, die Datenbankleistung und Abfrage Ausführungszeiten in die Analyse der Art und Weise, wie schnell Ihre Webanforderungen verarbeitet werden, zu integrieren.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-131">If you are using Azure, then [Azure Application Insights](https://docs.microsoft.com/azure/azure-monitor/learn/tutorial-performance) provides such powerful monitoring out of the box, integrating database performance and query execution times in the analysis of how quickly your web requests are being served.</span></span> <span data-ttu-id="f3f5a-132">Weitere Informationen hierzu finden Sie im Tutorial zur [Application Insights Leistung](/azure/azure-monitor/learn/tutorial-performance)und auf der [Seite Azure SQL-Analyse](/azure/azure-monitor/insights/azure-sql).</span><span class="sxs-lookup"><span data-stu-id="f3f5a-132">More information on this is available in the [Application Insights performance tutorial](/azure/azure-monitor/learn/tutorial-performance), and in the [Azure SQL analytics page](/azure/azure-monitor/insights/azure-sql).</span></span>

## <a name="inspecting-query-execution-plans"></a><span data-ttu-id="f3f5a-133">Überprüfen von Abfrage Ausführungsplänen</span><span class="sxs-lookup"><span data-stu-id="f3f5a-133">Inspecting query execution plans</span></span>

<span data-ttu-id="f3f5a-134">Wenn Sie auf eine problematische Abfrage geklickt haben, die optimiert werden muss, wird im nächsten Schritt in der Regel der *Ausführungsplan* der Abfrage analysiert.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-134">Once you've pinpointed a problematic query that requires optimization, the next step is usually analyzing the query's *execution plan*.</span></span> <span data-ttu-id="f3f5a-135">Wenn Datenbanken eine SQL-Anweisung empfangen, wird in der Regel ein Plan zur Ausführung des Plans erzeugt. Dies erfordert mitunter eine komplizierte Entscheidungsfindung, je nachdem, welche Indizes definiert wurden, wie viele Daten in Tabellen vorhanden sind usw. (der Plan selbst sollte in der Regel auf dem Server zwischengespeichert werden, um eine optimale Leistung zu erzielen).</span><span class="sxs-lookup"><span data-stu-id="f3f5a-135">When databases receive a SQL statement, they typically produce a plan of how that plan is to be executed; this sometimes requires complicated decision-making based on which indexes have been defined, how much data exists in tables, etc. (incidentally, the plan itself should usually be cached at the server for optimal performance).</span></span> <span data-ttu-id="f3f5a-136">Relationale Datenbanken bieten Benutzern in der Regel die Möglichkeit, den Abfrageplan zusammen mit der berechneten Kosten für verschiedene Teile der Abfrage anzuzeigen. Dies ist für die Verbesserung Ihrer Abfragen von Bedeutung.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-136">Relational databases typically provide a way for users to see the query plan, along with calculated costing for different parts of the query; this is invaluable for improving your queries.</span></span>

<span data-ttu-id="f3f5a-137">Informationen zu den ersten Schritten mit SQL Server finden Sie in der Dokumentation zu [Abfrage Ausführungsplänen](/sql/relational-databases/performance/execution-plans).</span><span class="sxs-lookup"><span data-stu-id="f3f5a-137">To get started on SQL Server, see the documentation on [query execution plans](/sql/relational-databases/performance/execution-plans).</span></span> <span data-ttu-id="f3f5a-138">Der typische Analyse Workflow wäre, [SQL Server Management Studio](/sql/relational-databases/performance/display-an-actual-execution-plan)zu verwenden, das SQL einer langsamen Abfrage, die über eine der oben genannten Mittel festgelegt wurde, zu einfügen und [einen grafischen Ausführungsplan zu erstellen](/sql/relational-databases/performance/display-an-actual-execution-plan):</span><span class="sxs-lookup"><span data-stu-id="f3f5a-138">The typical analysis workflow would be to use [SQL Server Management Studio](/sql/relational-databases/performance/display-an-actual-execution-plan), pasting the SQL of a slow query identified via one of the means above, and [producing a graphical execution plan](/sql/relational-databases/performance/display-an-actual-execution-plan):</span></span>

![Anzeigen eines SQL Server Ausführungs Plans](_static/actualexecplan.png)

<span data-ttu-id="f3f5a-140">Obwohl Ausführungspläne zunächst kompliziert erscheinen, ist es sinnvoll, sich mit Ihnen vertraut zu machen.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-140">While execution plans may seem complicated at first, it's worth spending a bit of time getting familiar with them.</span></span> <span data-ttu-id="f3f5a-141">Es ist besonders wichtig, die mit den einzelnen Knoten des Plans verbundenen Kosten zu notieren und zu ermitteln, wie Indizes in den verschiedenen Knoten verwendet werden (oder nicht).</span><span class="sxs-lookup"><span data-stu-id="f3f5a-141">It's particularly important to note the costs associated with each node of the plan, and to identify how indexes are used (or not) in the various nodes.</span></span>

<span data-ttu-id="f3f5a-142">Obwohl die oben genannten Informationen für SQL Server spezifisch sind, bieten andere Datenbanken in der Regel die gleiche Art von Tools mit ähnlicher Visualisierung.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-142">While the above information is specific to SQL Server, other databases typically provide the same kind of tools with similar visualization.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f3f5a-143">Datenbanken generieren manchmal unterschiedliche Abfrage Pläne, abhängig von den tatsächlichen Daten in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-143">Databases sometimes generate different query plans depending on actual data in the database.</span></span> <span data-ttu-id="f3f5a-144">Wenn eine Tabelle z. b. nur wenige Zeilen enthält, kann eine Datenbank auswählen, dass kein Index für diese Tabelle verwendet wird, sondern stattdessen ein vollständiger Tabellenscan durchgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-144">For example, if a table contains only a few rows, a database may choose not to use an index on that table, but to perform a full table scan instead.</span></span> <span data-ttu-id="f3f5a-145">Wenn Sie Abfrage Pläne für eine Testdatenbank analysieren, stellen Sie immer sicher, dass Sie Daten enthält, die dem Produktionssystem ähneln.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-145">If analyzing query plans on a test database, always make sure it contains data that is similar to your production system.</span></span>

## <a name="event-counters"></a><span data-ttu-id="f3f5a-146">Ereignisindikatoren</span><span class="sxs-lookup"><span data-stu-id="f3f5a-146">Event counters</span></span>

<span data-ttu-id="f3f5a-147">In den obigen Abschnitten wurde erläutert, wie Sie Informationen zu ihren Befehlen erhalten und wie diese Befehle in der Datenbank ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-147">The above sections focused on how to get information about your commands, and how these commands are executed in the database.</span></span> <span data-ttu-id="f3f5a-148">Darüber hinaus macht EF eine Reihe von *Ereignis* Indikatoren verfügbar, die genauere Informationen zu den Vorgängen in EF und ihrer Anwendung bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-148">In addition to that, EF exposes a set of *event counters* which provide more lower-level information on what's happening inside EF itself, and how your application is using it.</span></span> <span data-ttu-id="f3f5a-149">Diese Leistungsindikatoren können sehr nützlich sein, um bestimmte Leistungsprobleme und Leistungs Anomalien zu diagnostizieren, wie z. b. Probleme bei der [Abfrage](xref:core/performance/advanced-performance-topics#dynamically-constructed-queries) Zwischenspeicherung, die eine Konstante Neukompilierung, nicht ausgelegte dbcontext-Lecks und andere verursachen</span><span class="sxs-lookup"><span data-stu-id="f3f5a-149">These counters can be very useful for diagnosing specific performance issues and performance anomalies, such as [query caching issues](xref:core/performance/advanced-performance-topics#dynamically-constructed-queries) which cause constant recompilation, undisposed DbContext leaks, and others.</span></span>

<span data-ttu-id="f3f5a-150">Weitere Informationen finden Sie auf der dedizierten Seite zu den Ereignis Indikatoren von [EF](xref:core/logging-events-diagnostics/event-counters) .</span><span class="sxs-lookup"><span data-stu-id="f3f5a-150">See the dedicated page on [EF's event counters](xref:core/logging-events-diagnostics/event-counters) for more information.</span></span>

## <a name="benchmarking-with-ef-core"></a><span data-ttu-id="f3f5a-151">Benchmarktests mit EF Core</span><span class="sxs-lookup"><span data-stu-id="f3f5a-151">Benchmarking with EF Core</span></span>

<span data-ttu-id="f3f5a-152">Am Ende des Tages müssen Sie manchmal wissen, ob eine bestimmte Methode zum Schreiben oder Ausführen einer Abfrage schneller als eine andere ist.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-152">At the end of the day, you sometimes need to know whether a particular way of writing or executing a query is faster than another.</span></span> <span data-ttu-id="f3f5a-153">Es ist wichtig, die Antwort niemals zu übernehmen oder zu überdenken, und es ist äußerst einfach, einen schnellen Benchmark zu kombinieren, um die Antwort zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-153">It's important to never assume or speculate the answer, and it's extremely easy to put together a quick benchmark to get the answer.</span></span> <span data-ttu-id="f3f5a-154">Beim Schreiben von Benchmarks wird dringend empfohlen, die bekannte [benchmarkdotnet](https://benchmarkdotnet.org/index.html) -Bibliothek zu verwenden, die viele Fehler behandelt, die Benutzer beim Schreiben Ihrer eigenen Benchmarks treffen: haben Sie einige Aufwärm Iterationen durchgeführt?</span><span class="sxs-lookup"><span data-stu-id="f3f5a-154">When writing benchmarks, it's strongly recommended to use the well-known [BenchmarkDotNet](https://benchmarkdotnet.org/index.html) library, which handles many pitfalls users encounter when trying to write their own benchmarks: have you performed some warmup iterations?</span></span> <span data-ttu-id="f3f5a-155">Wie viele Iterationen werden tatsächlich durchgeführt und warum?</span><span class="sxs-lookup"><span data-stu-id="f3f5a-155">How many iterations does your benchmark actually run, and why?</span></span> <span data-ttu-id="f3f5a-156">Sehen wir uns an, wie ein Benchmark mit EF Core aussieht.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-156">Let's take a look at what a benchmark with EF Core looks like.</span></span>

> [!TIP]
> <span data-ttu-id="f3f5a-157">Das vollständige Benchmark-Projekt für die unten stehende Quelle ist [hier](https://github.com/dotnet/EntityFramework.Docs/tree/master/samples/core/Benchmarks/AverageBlogRanking.cs)verfügbar.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-157">The full benchmark project for the source below is available [here](https://github.com/dotnet/EntityFramework.Docs/tree/master/samples/core/Benchmarks/AverageBlogRanking.cs).</span></span> <span data-ttu-id="f3f5a-158">Es wird empfohlen, die Datei zu kopieren und als Vorlage für Ihre eigenen Benchmarks zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-158">You are encouraged to copy it and use it as a template for your own benchmarks.</span></span>

<span data-ttu-id="f3f5a-159">Als einfaches Vergleichs Szenario vergleichen wir die folgenden verschiedenen Methoden zum Berechnen der durchschnittlichen Rangfolge aller Blogs in unserer Datenbank:</span><span class="sxs-lookup"><span data-stu-id="f3f5a-159">As a simple benchmark scenario, let's compare the following different methods of calculating the average ranking of all Blogs in our database:</span></span>

* <span data-ttu-id="f3f5a-160">Laden Sie alle Entitäten, addieren Sie Ihre einzelnen Rang folgen, und berechnen Sie den Durchschnitt.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-160">Load all entities, sum up their individual rankings, and calculate the average.</span></span>
* <span data-ttu-id="f3f5a-161">Verwenden Sie wie oben beschrieben nur eine Abfrage ohne Nachverfolgung.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-161">The same as above, only use a non-tracking query.</span></span> <span data-ttu-id="f3f5a-162">Dies sollte schneller erfolgen, da die Identitäts Auflösung nicht durchgeführt wird und die Entitäten für die Änderungs Nachverfolgung nicht per snapshotet werden.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-162">This should be faster, since identity resolution isn't performed, and the entities aren't snapshotted for the purposes of change tracking.</span></span>
* <span data-ttu-id="f3f5a-163">Vermeiden Sie das Laden der gesamten blobentitätsinstanzen, indem Sie nur die Rangfolge projizieren.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-163">Avoid loading the entire Blog entity instances at all, by projecting out the ranking only.</span></span> <span data-ttu-id="f3f5a-164">Das speichert uns daran, die anderen, nicht benötigten Spalten des Blog-Entitäts Typs zu übertragen.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-164">The saves us from transferring the other, unneeded columns of the Blog entity type.</span></span>
* <span data-ttu-id="f3f5a-165">Berechnen Sie den Durchschnitt in der Datenbank, indem Sie ihn in die Abfrage einteilen.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-165">Calculate the average in the database by making it part of the query.</span></span> <span data-ttu-id="f3f5a-166">Dies sollte die schnellste Methode sein, da alles in der Datenbank berechnet wird und nur das Ergebnis zurück an den Client übertragen wird.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-166">This should be the fastest way, since everything is calculated in the database and only the result is transferred back to the client.</span></span>

<span data-ttu-id="f3f5a-167">Mit benchmarkdotnet schreiben Sie den Code, der als einfache Methode bezeichnet werden soll (genau wie ein Komponenten Test), und benchmarkdotnet führt automatisch jede Methode für eine ausreichende Anzahl von Iterationen aus, wobei zuverlässig gemessen wird, wie lange es dauert und wie viel Arbeitsspeicher zugeordnet wird.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-167">With BenchmarkDotNet, you write the code to be benchmarked as a simple method - just like a unit test - and BenchmarkDotNet automatically runs each method for sufficient number of iterations, reliably measuring how long it takes and how much memory is allocated.</span></span> <span data-ttu-id="f3f5a-168">Hier sehen Sie die verschiedenen Methoden ([der vollständige Benchmarkcode finden Sie hier](https://github.com/dotnet/EntityFramework.Docs/tree/master/samples/core/Benchmarks/AverageBlogRanking.cs)):</span><span class="sxs-lookup"><span data-stu-id="f3f5a-168">Here are the different method ([the full benchmark code can be seen here](https://github.com/dotnet/EntityFramework.Docs/tree/master/samples/core/Benchmarks/AverageBlogRanking.cs)):</span></span>

### <a name="load-entities"></a>[<span data-ttu-id="f3f5a-169">Laden von Entitäten</span><span class="sxs-lookup"><span data-stu-id="f3f5a-169">Load entities</span></span>](#tab/load-entities)

[!code-csharp[Main](../../../samples/core/Benchmarks/AverageBlogRanking.cs?name=LoadEntities)]

### <a name="load-entities-no-tracking"></a>[<span data-ttu-id="f3f5a-170">Laden von Entitäten, keine Nachverfolgung</span><span class="sxs-lookup"><span data-stu-id="f3f5a-170">Load entities, no tracking</span></span>](#tab/load-entities-no-tracking)

[!code-csharp[Main](../../../samples/core/Benchmarks/AverageBlogRanking.cs?name=LoadEntitiesNoTracking)]

### <a name="project-only-ranking"></a>[<span data-ttu-id="f3f5a-171">Nur Projekt Rangfolge</span><span class="sxs-lookup"><span data-stu-id="f3f5a-171">Project only ranking</span></span>](#tab/project-only-ranking)

[!code-csharp[Main](../../../samples/core/Benchmarks/AverageBlogRanking.cs?name=ProjectOnlyRanking)]

### <a name="calculate-in-database"></a>[<span data-ttu-id="f3f5a-172">In Datenbank berechnen</span><span class="sxs-lookup"><span data-stu-id="f3f5a-172">Calculate in database</span></span>](#tab/calculate-in-database)

[!code-csharp[Main](../../../samples/core/Benchmarks/AverageBlogRanking.cs?name=CalculateInDatabase)]

***

<span data-ttu-id="f3f5a-173">Die Ergebnisse sind unten aufgeführt, wie von benchmarkdotnet gedruckt:</span><span class="sxs-lookup"><span data-stu-id="f3f5a-173">The results are below, as printed by BenchmarkDotNet:</span></span>

|                 <span data-ttu-id="f3f5a-174">Methode</span><span class="sxs-lookup"><span data-stu-id="f3f5a-174">Method</span></span> |       <span data-ttu-id="f3f5a-175">Mittelwert</span><span class="sxs-lookup"><span data-stu-id="f3f5a-175">Mean</span></span> |    <span data-ttu-id="f3f5a-176">Fehler</span><span class="sxs-lookup"><span data-stu-id="f3f5a-176">Error</span></span> |   <span data-ttu-id="f3f5a-177">StdDev</span><span class="sxs-lookup"><span data-stu-id="f3f5a-177">StdDev</span></span> |     <span data-ttu-id="f3f5a-178">Median</span><span class="sxs-lookup"><span data-stu-id="f3f5a-178">Median</span></span> | <span data-ttu-id="f3f5a-179">Seitenverhältnis</span><span class="sxs-lookup"><span data-stu-id="f3f5a-179">Ratio</span></span> | <span data-ttu-id="f3f5a-180">Ratiosd</span><span class="sxs-lookup"><span data-stu-id="f3f5a-180">RatioSD</span></span> |    <span data-ttu-id="f3f5a-181">Gen 0</span><span class="sxs-lookup"><span data-stu-id="f3f5a-181">Gen 0</span></span> |   <span data-ttu-id="f3f5a-182">Gen 1</span><span class="sxs-lookup"><span data-stu-id="f3f5a-182">Gen 1</span></span> | <span data-ttu-id="f3f5a-183">Gen 2</span><span class="sxs-lookup"><span data-stu-id="f3f5a-183">Gen 2</span></span> |  <span data-ttu-id="f3f5a-184">Zugeordnet</span><span class="sxs-lookup"><span data-stu-id="f3f5a-184">Allocated</span></span> |
|----------------------- |-----------:|---------:|---------:|-----------:|------:|--------:|---------:|--------:|------:|-----------:|
|           <span data-ttu-id="f3f5a-185">Loadentities</span><span class="sxs-lookup"><span data-stu-id="f3f5a-185">LoadEntities</span></span> | <span data-ttu-id="f3f5a-186">2.860,4 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-186">2,860.4 us</span></span> | <span data-ttu-id="f3f5a-187">54,31 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-187">54.31 us</span></span> | <span data-ttu-id="f3f5a-188">93,68 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-188">93.68 us</span></span> | <span data-ttu-id="f3f5a-189">2.844,5 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-189">2,844.5 us</span></span> |  <span data-ttu-id="f3f5a-190">4.55</span><span class="sxs-lookup"><span data-stu-id="f3f5a-190">4.55</span></span> |    <span data-ttu-id="f3f5a-191">0,33</span><span class="sxs-lookup"><span data-stu-id="f3f5a-191">0.33</span></span> | <span data-ttu-id="f3f5a-192">210,9375</span><span class="sxs-lookup"><span data-stu-id="f3f5a-192">210.9375</span></span> | <span data-ttu-id="f3f5a-193">70,3125</span><span class="sxs-lookup"><span data-stu-id="f3f5a-193">70.3125</span></span> |     - | <span data-ttu-id="f3f5a-194">1309,56 KB</span><span class="sxs-lookup"><span data-stu-id="f3f5a-194">1309.56 KB</span></span> |
| <span data-ttu-id="f3f5a-195">Loadentitiesnotracking</span><span class="sxs-lookup"><span data-stu-id="f3f5a-195">LoadEntitiesNoTracking</span></span> | <span data-ttu-id="f3f5a-196">1.353,0 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-196">1,353.0 us</span></span> | <span data-ttu-id="f3f5a-197">21,26 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-197">21.26 us</span></span> | <span data-ttu-id="f3f5a-198">18,85 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-198">18.85 us</span></span> | <span data-ttu-id="f3f5a-199">1.355,6 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-199">1,355.6 us</span></span> |  <span data-ttu-id="f3f5a-200">2.10</span><span class="sxs-lookup"><span data-stu-id="f3f5a-200">2.10</span></span> |    <span data-ttu-id="f3f5a-201">0.14</span><span class="sxs-lookup"><span data-stu-id="f3f5a-201">0.14</span></span> |  <span data-ttu-id="f3f5a-202">87,8906</span><span class="sxs-lookup"><span data-stu-id="f3f5a-202">87.8906</span></span> |  <span data-ttu-id="f3f5a-203">3,9063</span><span class="sxs-lookup"><span data-stu-id="f3f5a-203">3.9063</span></span> |     - |  <span data-ttu-id="f3f5a-204">540,09 KB</span><span class="sxs-lookup"><span data-stu-id="f3f5a-204">540.09 KB</span></span> |
|     <span data-ttu-id="f3f5a-205">Projectonlyrangfolge</span><span class="sxs-lookup"><span data-stu-id="f3f5a-205">ProjectOnlyRanking</span></span> |   <span data-ttu-id="f3f5a-206">910,9 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-206">910.9 us</span></span> | <span data-ttu-id="f3f5a-207">20,91 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-207">20.91 us</span></span> | <span data-ttu-id="f3f5a-208">61,65 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-208">61.65 us</span></span> |   <span data-ttu-id="f3f5a-209">892,9 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-209">892.9 us</span></span> |  <span data-ttu-id="f3f5a-210">1,46</span><span class="sxs-lookup"><span data-stu-id="f3f5a-210">1.46</span></span> |    <span data-ttu-id="f3f5a-211">0.14</span><span class="sxs-lookup"><span data-stu-id="f3f5a-211">0.14</span></span> |  <span data-ttu-id="f3f5a-212">41,0156</span><span class="sxs-lookup"><span data-stu-id="f3f5a-212">41.0156</span></span> |  <span data-ttu-id="f3f5a-213">0,9766</span><span class="sxs-lookup"><span data-stu-id="f3f5a-213">0.9766</span></span> |     - |  <span data-ttu-id="f3f5a-214">252,08 KB</span><span class="sxs-lookup"><span data-stu-id="f3f5a-214">252.08 KB</span></span> |
|    <span data-ttu-id="f3f5a-215">Calculateingedatabase</span><span class="sxs-lookup"><span data-stu-id="f3f5a-215">CalculateInDatabase</span></span> |   <span data-ttu-id="f3f5a-216">627,1 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-216">627.1 us</span></span> | <span data-ttu-id="f3f5a-217">14,58 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-217">14.58 us</span></span> | <span data-ttu-id="f3f5a-218">42,54 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-218">42.54 us</span></span> |   <span data-ttu-id="f3f5a-219">626,4 US-</span><span class="sxs-lookup"><span data-stu-id="f3f5a-219">626.4 us</span></span> |  <span data-ttu-id="f3f5a-220">1.00</span><span class="sxs-lookup"><span data-stu-id="f3f5a-220">1.00</span></span> |    <span data-ttu-id="f3f5a-221">0.00</span><span class="sxs-lookup"><span data-stu-id="f3f5a-221">0.00</span></span> |   <span data-ttu-id="f3f5a-222">4,8828</span><span class="sxs-lookup"><span data-stu-id="f3f5a-222">4.8828</span></span> |       - |     - |   <span data-ttu-id="f3f5a-223">33,27 KB</span><span class="sxs-lookup"><span data-stu-id="f3f5a-223">33.27 KB</span></span> |

> [!NOTE]
> <span data-ttu-id="f3f5a-224">Wenn die-Methoden den Kontext in der-Methode instanziieren und verwerfen, werden diese Vorgänge für den Benchmarkwert gezählt, obwohl Sie streng genommen nicht Teil des Abfrage Prozesses sind.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-224">As the methods instantiate and dispose the context within the method, these operations are counted for the benchmark, although strictly speaking they are not part of the querying process.</span></span> <span data-ttu-id="f3f5a-225">Dies sollte nicht von Bedeutung sein, wenn zwei Alternativen miteinander verglichen werden sollen (da die Kontext Instanziierung und-Entsorgung identisch sind) und eine stärker ganzheitliche Messung für den gesamten Vorgang durchführt.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-225">This should not matter if the goal is to compare two alternatives to one another (since the context instantiation and disposal are the same), and gives a more holistic measurement for the entire operation.</span></span>

<span data-ttu-id="f3f5a-226">Eine Einschränkung von benchmarkdotnet besteht darin, dass Sie eine einfache Leistung der einzelnen Threads der von Ihnen bereitgestellten Methoden misst und daher nicht für benchmarkübergreifende Szenarios geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-226">One limitation of BenchmarkDotNet is that it measures simple, single-thread performance of the methods you provide, and is therefore not well-suited for benchmarking concurrent scenarios.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f3f5a-227">Stellen Sie immer sicher, dass Daten in der Datenbank vorhanden sind, die Produktionsdaten beim benchmarkvorgang ähneln; andernfalls stellen die Vergleichstests möglicherweise nicht die tatsächliche Leistung in der Produktion dar.</span><span class="sxs-lookup"><span data-stu-id="f3f5a-227">Always make sure to have data in your database that is similar to production data when benchmarking, otherwise the benchmark results may not represent actual performance in production.</span></span>
