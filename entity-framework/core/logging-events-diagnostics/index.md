---
title: 'Überblick über Protokollierung und Abfangfunktionen: EF Core'
description: Übersicht über Protokollierung, Ereignisse, Interceptors und Diagnosefunktionen für EF Core
author: ajcvickers
ms.date: 10/01/2020
uid: core/logging-events-diagnostics/index
ms.openlocfilehash: fdf536dc6ec15e6e520d574b14527a4e7a7b1d72
ms.sourcegitcommit: f3512e3a98e685a3ba409c1d0157ce85cc390cf4
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/10/2020
ms.locfileid: "94431120"
---
# <a name="overview-of-logging-and-interception"></a><span data-ttu-id="2c035-103">Übersicht über Protokollierung und Abfangfunktionen</span><span class="sxs-lookup"><span data-stu-id="2c035-103">Overview of Logging and Interception</span></span>

<span data-ttu-id="2c035-104">Entity Framework Core (EF Core) enthält mehrere Mechanismen für das Erstellen von Protokollen, Reagieren auf Ereignisse und Erstellen von Diagnosen.</span><span class="sxs-lookup"><span data-stu-id="2c035-104">Entity Framework Core (EF Core) contains several mechanisms for generating logs, responding to events, and obtaining diagnostics.</span></span> <span data-ttu-id="2c035-105">Diese Mechanismen sind jeweils auf verschiedene Situationen zugeschnitten, und es ist wichtig, den besten Mechanismus für die betreffende Aufgabe auszuwählen, auch wenn mehrere Mechanismen möglich wären.</span><span class="sxs-lookup"><span data-stu-id="2c035-105">Each of these is tailored to different situations, and it is important to select the best mechanism for the task in hand, even when multiple mechanisms could work.</span></span> <span data-ttu-id="2c035-106">Ein Datenbankinterceptor könnte beispielsweise für eine SQL-Protokollierung verwendet werden. Besser hierfür eignen sich jedoch protokollierungsspezifische Mechanismen.</span><span class="sxs-lookup"><span data-stu-id="2c035-106">For example, a database interceptor could be used to log SQL, but this is better handled by one of the mechanisms tailored to logging.</span></span> <span data-ttu-id="2c035-107">Auf dieser Seite finden Sie eine Übersicht der verschiedenen Mechanismen sowie Erläuterungen, wann die einzelnen verwendet werden sollten.</span><span class="sxs-lookup"><span data-stu-id="2c035-107">This page presents an overview of each of these mechanisms and describes when each should be used.</span></span>

## <a name="quick-reference"></a><span data-ttu-id="2c035-108">Kurzreferenz</span><span class="sxs-lookup"><span data-stu-id="2c035-108">Quick reference</span></span>

<span data-ttu-id="2c035-109">In der folgenden Tabelle finden Sie eine kurze Übersicht über die Unterschiede zwischen den hier beschriebenen Mechanismen.</span><span class="sxs-lookup"><span data-stu-id="2c035-109">The table below provides a quick reference for the differences between the mechanisms described here.</span></span>

| <span data-ttu-id="2c035-110">Mechanismus</span><span class="sxs-lookup"><span data-stu-id="2c035-110">Mechanism</span></span> |  <span data-ttu-id="2c035-111">Async</span><span class="sxs-lookup"><span data-stu-id="2c035-111">Async</span></span> | <span data-ttu-id="2c035-112">`Scope`</span><span class="sxs-lookup"><span data-stu-id="2c035-112">Scope</span></span> | <span data-ttu-id="2c035-113">Registriert</span><span class="sxs-lookup"><span data-stu-id="2c035-113">Registered</span></span> | <span data-ttu-id="2c035-114">Beabsichtigte Verwendung</span><span class="sxs-lookup"><span data-stu-id="2c035-114">Intended use</span></span>
|:----------|--------|-------|------------|-------------
| <span data-ttu-id="2c035-115">Einfache Protokollierung</span><span class="sxs-lookup"><span data-stu-id="2c035-115">Simple Logging</span></span> | <span data-ttu-id="2c035-116">Nein</span><span class="sxs-lookup"><span data-stu-id="2c035-116">No</span></span> | <span data-ttu-id="2c035-117">Pro Kontext</span><span class="sxs-lookup"><span data-stu-id="2c035-117">Per context</span></span> | <span data-ttu-id="2c035-118">Kontextbezogene Konfiguration</span><span class="sxs-lookup"><span data-stu-id="2c035-118">Context configuration</span></span> | <span data-ttu-id="2c035-119">Protokollierung zur Entwicklungszeit</span><span class="sxs-lookup"><span data-stu-id="2c035-119">Development-time logging</span></span>
| <span data-ttu-id="2c035-120">Microsoft.Extensions.Logging</span><span class="sxs-lookup"><span data-stu-id="2c035-120">Microsoft.Extensions.Logging</span></span> | <span data-ttu-id="2c035-121">Nein</span><span class="sxs-lookup"><span data-stu-id="2c035-121">No</span></span> | <span data-ttu-id="2c035-122">Pro Kontext\*</span><span class="sxs-lookup"><span data-stu-id="2c035-122">Per context\*</span></span> | <span data-ttu-id="2c035-123">Abhängigkeitsinjektion</span><span class="sxs-lookup"><span data-stu-id="2c035-123">D.I.</span></span> <span data-ttu-id="2c035-124">oder kontextbezogene Konfiguration</span><span class="sxs-lookup"><span data-stu-id="2c035-124">or context configuration</span></span> | <span data-ttu-id="2c035-125">Produktionsprotokollierung</span><span class="sxs-lookup"><span data-stu-id="2c035-125">Production logging</span></span>
| <span data-ttu-id="2c035-126">Ereignisse</span><span class="sxs-lookup"><span data-stu-id="2c035-126">Events</span></span> | <span data-ttu-id="2c035-127">Nein</span><span class="sxs-lookup"><span data-stu-id="2c035-127">No</span></span> | <span data-ttu-id="2c035-128">Pro Kontext</span><span class="sxs-lookup"><span data-stu-id="2c035-128">Per context</span></span> | <span data-ttu-id="2c035-129">Beliebiger Zeitpunkt</span><span class="sxs-lookup"><span data-stu-id="2c035-129">Any time</span></span> | <span data-ttu-id="2c035-130">Reagieren auf EF-Ereignisse</span><span class="sxs-lookup"><span data-stu-id="2c035-130">Reacting to EF events</span></span>
| <span data-ttu-id="2c035-131">Interceptors</span><span class="sxs-lookup"><span data-stu-id="2c035-131">Interceptors</span></span> | <span data-ttu-id="2c035-132">Ja</span><span class="sxs-lookup"><span data-stu-id="2c035-132">Yes</span></span> | <span data-ttu-id="2c035-133">Pro Kontext</span><span class="sxs-lookup"><span data-stu-id="2c035-133">Per context</span></span> | <span data-ttu-id="2c035-134">Kontextbezogene Konfiguration</span><span class="sxs-lookup"><span data-stu-id="2c035-134">Context configuration</span></span> | <span data-ttu-id="2c035-135">Manipulieren von EF-Vorgängen</span><span class="sxs-lookup"><span data-stu-id="2c035-135">Manipulating EF operations</span></span>
| <span data-ttu-id="2c035-136">Diagnoselistener</span><span class="sxs-lookup"><span data-stu-id="2c035-136">Diagnostics listeners</span></span> | <span data-ttu-id="2c035-137">Nein</span><span class="sxs-lookup"><span data-stu-id="2c035-137">No</span></span> | <span data-ttu-id="2c035-138">Prozess</span><span class="sxs-lookup"><span data-stu-id="2c035-138">Process</span></span> | <span data-ttu-id="2c035-139">Global</span><span class="sxs-lookup"><span data-stu-id="2c035-139">Globally</span></span> | <span data-ttu-id="2c035-140">Anwendungsdiagnose</span><span class="sxs-lookup"><span data-stu-id="2c035-140">Application diagnostics</span></span>

<span data-ttu-id="2c035-141">\*`Microsoft.Extensions.Logging` wird in der Regel pro Anwendung über Abhängigkeitsinjektion konfiguriert. Auf der EF-Ebene _kann_ jedoch jeder Kontext bei Bedarf mit einer anderen Protokollierung konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="2c035-141">\*Typically `Microsoft.Extensions.Logging` is configured per-application via dependency injection However, at the EF level, each context _can_ be configured with a different logger if needed.</span></span>

## <a name="simple-logging"></a><span data-ttu-id="2c035-142">Einfache Protokollierung</span><span class="sxs-lookup"><span data-stu-id="2c035-142">Simple logging</span></span>

> [!NOTE]
> <span data-ttu-id="2c035-143">Dieses Feature wurde in EF Core 5.0 hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="2c035-143">This feature was added in EF Core 5.0.</span></span>

<span data-ttu-id="2c035-144">Der Zugriff auf EF Core-Protokolle ist über Anwendungen jeglichen Typs über die Verwendung von [LogTo](https://github.com/dotnet/efcore/blob/ec3df8fd7e4ea4ebeebfa747619cef37b23ab2c6/src/EFCore/DbContextOptionsBuilder.cs#L135)</span><span class="sxs-lookup"><span data-stu-id="2c035-144">EF Core logs can be accessed from any type of application through the use of [LogTo](https://github.com/dotnet/efcore/blob/ec3df8fd7e4ea4ebeebfa747619cef37b23ab2c6/src/EFCore/DbContextOptionsBuilder.cs#L135)</span></span> <!-- Issue #2748 <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder.LogTo%2A> --> <span data-ttu-id="2c035-145">beim [Konfigurieren einer DbContext-Instanz](xref:core/dbcontext-configuration/index) möglich.</span><span class="sxs-lookup"><span data-stu-id="2c035-145">when [configuring a DbContext instance](xref:core/dbcontext-configuration/index).</span></span> <span data-ttu-id="2c035-146">Diese Konfiguration erfolgt in der Regel durch ein Überschreiben von <xref:Microsoft.EntityFrameworkCore.DbContext.OnConfiguring%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2c035-146">This configuration is commonly done in an override of <xref:Microsoft.EntityFrameworkCore.DbContext.OnConfiguring%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="2c035-147">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="2c035-147">For example:</span></span>

<!--
    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        => optionsBuilder.LogTo(Console.WriteLine);
-->
[!code-csharp[LogToConsole](../../../samples/core/Miscellaneous/Logging/SimpleLogging/Program.cs?name=LogToConsole)]

<span data-ttu-id="2c035-148">Dieses Konzept ähnelt <xref:System.Data.Entity.Database.Log?displayProperty=nameWithType> in EF6.</span><span class="sxs-lookup"><span data-stu-id="2c035-148">This concept is similar to <xref:System.Data.Entity.Database.Log?displayProperty=nameWithType> in EF6.</span></span>

<span data-ttu-id="2c035-149">Weitere Informationen finden Sie unter [Einfache Protokollierung](xref:core/logging-events-diagnostics/simple-logging).</span><span class="sxs-lookup"><span data-stu-id="2c035-149">See [Simple Logging](xref:core/logging-events-diagnostics/simple-logging) for more information.</span></span>

## <a name="microsoftextensionslogging"></a><span data-ttu-id="2c035-150">Microsoft.Extensions.Logging</span><span class="sxs-lookup"><span data-stu-id="2c035-150">Microsoft.Extensions.Logging</span></span>

<span data-ttu-id="2c035-151">[Microsoft.Extensions.Logging](/dotnet/core/extensions/logging) ist ein erweiterbarer Protokollierungsmechanismus mit Plug-In-Anbietern für viele gängige Protokollierungssysteme.</span><span class="sxs-lookup"><span data-stu-id="2c035-151">[Microsoft.Extensions.Logging](/dotnet/core/extensions/logging) is an extensible logging mechanism with plug-in providers for many common logging systems.</span></span> <span data-ttu-id="2c035-152">EF Core ist vollständig in `Microsoft.Extensions.Logging` integriert, und diese Art von Protokollierung wird standardmäßig für ASP.NET Core-Anwendungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="2c035-152">EF Core fully integrates with `Microsoft.Extensions.Logging` and this form of logging is used by default for ASP.NET Core applications.</span></span>

<span data-ttu-id="2c035-153">Weitere Informationen finden Sie unter [Verwenden von Microsoft.Extensions.Logging in EF Core](xref:core/logging-events-diagnostics/extensions-logging).</span><span class="sxs-lookup"><span data-stu-id="2c035-153">See [Using Microsoft.Extensions.Logging in EF Core](xref:core/logging-events-diagnostics/extensions-logging) for more information.</span></span>

## <a name="events"></a><span data-ttu-id="2c035-154">Ereignisse</span><span class="sxs-lookup"><span data-stu-id="2c035-154">Events</span></span>

> [!NOTE]
> <span data-ttu-id="2c035-155">In EF Core 5.0 wurden weitere Ereignisse hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="2c035-155">Additional events were added in EF Core 5.0.</span></span>

<span data-ttu-id="2c035-156">EF Core stellt [.NET-Ereignisse](/dotnet/standard/events/) bereit, die als Rückrufe fungieren, wenn bestimmte Dinge im EF Core-Code auftreten.</span><span class="sxs-lookup"><span data-stu-id="2c035-156">EF Core exposes [.NET events](/dotnet/standard/events/) to act as callbacks when certain things happen in the EF Core code.</span></span> <span data-ttu-id="2c035-157">Ereignisse sind einfacher als Abfangfunktionen und ermöglichen eine flexiblere Registrierung.</span><span class="sxs-lookup"><span data-stu-id="2c035-157">Events are simpler than interceptors and allow more flexible registration.</span></span> <span data-ttu-id="2c035-158">Sie sind jedoch nur synchron und können daher keine nicht blockierenden asynchronen E/A-Vorgänge durchführen.</span><span class="sxs-lookup"><span data-stu-id="2c035-158">However, they are sync only and so cannot perform non-blocking async I/O.</span></span>

<span data-ttu-id="2c035-159">Ereignisse werden pro DbContext-Instanz registriert, und diese Registrierung kann zu einem beliebigen Zeitpunkt durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="2c035-159">Events are registered per DbContext instance and this registration can be done at any time.</span></span> <span data-ttu-id="2c035-160">Verwenden Sie einen [Diagnoselistener](xref:core/logging-events-diagnostics/diagnostic-listeners), um dieselben Informationen abzurufen, jedoch für alle DbContext-Instanzen im Prozess.</span><span class="sxs-lookup"><span data-stu-id="2c035-160">Use a [diagnostic listener](xref:core/logging-events-diagnostics/diagnostic-listeners) to get the same information but for all DbContext instances in the process.</span></span>

<span data-ttu-id="2c035-161">Weitere Informationen finden Sie unter [.NET-Ereignisse in EF Core](xref:core/logging-events-diagnostics/events).</span><span class="sxs-lookup"><span data-stu-id="2c035-161">See [.NET Events in EF Core](xref:core/logging-events-diagnostics/events) for more information.</span></span>

## <a name="interception"></a><span data-ttu-id="2c035-162">Interception</span><span class="sxs-lookup"><span data-stu-id="2c035-162">Interception</span></span>

> [!NOTE]
> <span data-ttu-id="2c035-163">Dieses Feature wurde in EF Core 3.0 hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="2c035-163">This feature was added in EF Core 3.0.</span></span> <span data-ttu-id="2c035-164">In EF Core 5.0 wurden weitere Abfangfunktionen hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="2c035-164">Additional interceptors were added in EF Core 5.0.</span></span>

<span data-ttu-id="2c035-165">EF Core-Abfangfunktionen ermöglichen das Abfangen, Ändern und/oder Unterdrücken von EF Core-Vorgängen.</span><span class="sxs-lookup"><span data-stu-id="2c035-165">EF Core interceptors enable interception, modification, and/or suppression of EF Core operations.</span></span> <span data-ttu-id="2c035-166">Dies umfasst Datenbankvorgänge auf niedriger Ebene, z. B. das Ausführen eines Befehls, sowie Vorgänge höherer Ebene, z. B. Aufrufe von SaveChanges.</span><span class="sxs-lookup"><span data-stu-id="2c035-166">This includes low-level database operations such as executing a command, as well as higher-level operations, such as calls to SaveChanges.</span></span>

<span data-ttu-id="2c035-167">Abfangfunktionen unterscheiden sich von Protokollierung und Diagnose insofern, als sie eine Änderung oder Unterdrückung des abzufangenden Vorgangs ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="2c035-167">Interceptors are different from logging and diagnostics in that they allow modification or suppression of the operation being intercepted.</span></span> <span data-ttu-id="2c035-168">[Einfache Protokollierung](xref:core/logging-events-diagnostics/simple-logging) oder [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) sind bessere Optionen für Protokollierung.</span><span class="sxs-lookup"><span data-stu-id="2c035-168">[Simple logging](xref:core/logging-events-diagnostics/simple-logging) or [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) are better choices for logging.</span></span>

<span data-ttu-id="2c035-169">Abfangfunktionen werden pro DbContext-Instanz registriert, wenn der Kontext konfiguriert wird.</span><span class="sxs-lookup"><span data-stu-id="2c035-169">Interceptors are registered per DbContext instance when the context is configured.</span></span> <span data-ttu-id="2c035-170">Verwenden Sie einen [Diagnoselistener](xref:core/logging-events-diagnostics/diagnostic-listeners), um dieselben Informationen abzurufen, jedoch für alle DbContext-Instanzen im Prozess.</span><span class="sxs-lookup"><span data-stu-id="2c035-170">Use a [diagnostic listener](xref:core/logging-events-diagnostics/diagnostic-listeners) to get the same information but for all DbContext instances in the process.</span></span>

<span data-ttu-id="2c035-171">Weitere Informationen finden Sie unter [Abfangfunktionen](xref:core/logging-events-diagnostics/interceptors).</span><span class="sxs-lookup"><span data-stu-id="2c035-171">See [Interception](xref:core/logging-events-diagnostics/interceptors) for more information.</span></span>

## <a name="diagnostic-listeners"></a><span data-ttu-id="2c035-172">Diagnoselistener</span><span class="sxs-lookup"><span data-stu-id="2c035-172">Diagnostic listeners</span></span>

<span data-ttu-id="2c035-173">Diagnoselistener ermöglichen das Lauschen auf EF Core-Ereignisse, die im aktuellen .NET-Prozess auftreten.</span><span class="sxs-lookup"><span data-stu-id="2c035-173">Diagnostic listeners allow listening for any EF Core event that occurs in the current .NET process.</span></span>

<span data-ttu-id="2c035-174">Diagnoselistener sind nicht geeignet, um Ereignisse aus einer einzelnen DbContext-Instanz abzurufen.</span><span class="sxs-lookup"><span data-stu-id="2c035-174">Diagnostic listeners are not suitable for getting events from a single DbContext instance.</span></span> <span data-ttu-id="2c035-175">EF Core-Abfangfunktionen ermöglichen Zugriff auf dieselben Ereignisse mit Pro-Kontext-Registrierung.</span><span class="sxs-lookup"><span data-stu-id="2c035-175">EF Core interceptors provide access to the same events with per-context registration.</span></span>

<span data-ttu-id="2c035-176">Diagnoselistener sind nicht für Protokollierung konzipiert.</span><span class="sxs-lookup"><span data-stu-id="2c035-176">Diagnostic listeners are not designed for logging.</span></span> <span data-ttu-id="2c035-177">[Einfache Protokollierung](xref:core/logging-events-diagnostics/simple-logging) oder [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) sind bessere Optionen für Protokollierung.</span><span class="sxs-lookup"><span data-stu-id="2c035-177">[Simple logging](xref:core/logging-events-diagnostics/simple-logging) or [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) are better choices for logging.</span></span>

<span data-ttu-id="2c035-178">Weitere Informationen finden Sie unter [Verwenden von Diagnoselistenern in EF Core](xref:core/logging-events-diagnostics/diagnostic-listeners).</span><span class="sxs-lookup"><span data-stu-id="2c035-178">See [Using diagnostic listeners in EF Core](xref:core/logging-events-diagnostics/diagnostic-listeners) for more information.</span></span>
