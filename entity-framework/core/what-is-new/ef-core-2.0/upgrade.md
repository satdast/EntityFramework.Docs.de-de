---
title: 'EF Core: Upgrade für frühere Versionen auf EF Core 2'
description: In diesem Artikel finden Sie Anweisungen und Hinweise zum Durchführen eines Upgrades auf Entity Framework Core 2.0.
author: ajcvickers
ms.date: 08/13/2017
uid: core/what-is-new/ef-core-2.0/upgrade
ms.openlocfilehash: 5054661d308e7ea6acd433981dfb2af6026b7765
ms.sourcegitcommit: f3512e3a98e685a3ba409c1d0157ce85cc390cf4
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/10/2020
ms.locfileid: "94430091"
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="840b4-103">Durchführen eines Upgrades für Anwendungen mit früheren Versionen auf EF Core 2.0</span><span class="sxs-lookup"><span data-stu-id="840b4-103">Upgrading applications from previous versions to EF Core 2.0</span></span>

<span data-ttu-id="840b4-104">Die vorhandenen APIs und Verhaltensweisen wurden mit EF Core 2.0 deutlich verfeinert.</span><span class="sxs-lookup"><span data-stu-id="840b4-104">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="840b4-105">Für einige dieser Verbesserungen können Änderungen an vorhandenem Anwendungscode erforderlich sein. Dies sollte für einen Großteil von Anwendungen nur geringe Auswirkungen haben. In den meisten Fällen sollten lediglich eine Neukompilierung und minimale Änderungen zum Ersetzen veralteter APIs erforderlich sein.</span><span class="sxs-lookup"><span data-stu-id="840b4-105">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

<span data-ttu-id="840b4-106">Für das Update einer vorhandenen Anwendung auf EF Core 2.0 kann Folgendes erforderlich sein:</span><span class="sxs-lookup"><span data-stu-id="840b4-106">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="840b4-107">Durchführen eines Upgrade für die .NET-Zielimplementierung der Anwendung auf eine Version, die .NET Standard 2.0 unterstützt</span><span class="sxs-lookup"><span data-stu-id="840b4-107">Upgrading the target .NET implementation of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="840b4-108">(Weitere Informationen finden Sie unter [Unterstützte .NET-Implementierungen](xref:core/miscellaneous/platforms).)</span><span class="sxs-lookup"><span data-stu-id="840b4-108">See [Supported .NET Implementations](xref:core/miscellaneous/platforms) for more details.</span></span>

2. <span data-ttu-id="840b4-109">Identifizieren eines Anbieters für die Zieldatenbank, die mit EF Core 2.0 kompatibel ist</span><span class="sxs-lookup"><span data-stu-id="840b4-109">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="840b4-110">(Weitere Informationen finden Sie unten unter [EF Core 2.0 erfordert einen 2.0-Datenbankanbieter](#ef-core-20-requires-a-20-database-provider).)</span><span class="sxs-lookup"><span data-stu-id="840b4-110">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="840b4-111">Durchführen von Upgrades auf Version 2.0 für alle EF Core-Pakete (Runtime und Tools)</span><span class="sxs-lookup"><span data-stu-id="840b4-111">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="840b4-112">(Ausführliche Informationen finden Sie unter [Installieren von EF Core](xref:core/get-started/overview/install).)</span><span class="sxs-lookup"><span data-stu-id="840b4-112">Refer to [Installing EF Core](xref:core/get-started/overview/install) for more details.</span></span>

4. <span data-ttu-id="840b4-113">Vornehmen jeglicher notwendigen Codeänderungen, um die im restlichen Dokument beschriebenen Breaking Changes auszugleichen</span><span class="sxs-lookup"><span data-stu-id="840b4-113">Make any necessary code changes to compensate for the breaking changes described in the rest of this document.</span></span>

## <a name="aspnet-core-now-includes-ef-core"></a><span data-ttu-id="840b4-114">ASP.NET Core umfasst nun EF Core</span><span class="sxs-lookup"><span data-stu-id="840b4-114">ASP.NET Core now includes EF Core</span></span>

<span data-ttu-id="840b4-115">Anwendungen, deren Zielversionen für ASP.NET Core 2.0 festgelegt sind, können neben Datenbankanbietern von Drittanbietern EF Core 2.0 ohne zusätzliche Abhängigkeiten nutzen.</span><span class="sxs-lookup"><span data-stu-id="840b4-115">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="840b4-116">Allerdings müssen für Anwendungen für vorherige Versionen von ASP.NET Core Upgrades auf ASP.NET Core 2.0 durchgeführt werden, damit EF Core 2.0 verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="840b4-116">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="840b4-117">Ausführliche Informationen zum Durchführen von Upgrades für ASP.NET Core-Anwendungen auf Version 2.0 finden Sie in der [ASP.NET Core-Dokumentation zum Thema](/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="840b4-117">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="new-way-of-getting-application-services-in-aspnet-core"></a><span data-ttu-id="840b4-118">Neue Methode zum Abrufen der Anwendungsdienste in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="840b4-118">New way of getting application services in ASP.NET Core</span></span>

<span data-ttu-id="840b4-119">Das empfohlene Muster für ASP.NET Core-Webanwendungen wurde für Version 2.0 so aktualisiert, dass die Entwurfszeitlogik von EF Core 1.x nicht mehr funktionierte.</span><span class="sxs-lookup"><span data-stu-id="840b4-119">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="840b4-120">Zuvor versuchte EF Core zur Entwurfszeit, `Startup.ConfigureServices` direkt aufzurufen, um auf den Dienstanbieter der Anwendung zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="840b4-120">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="840b4-121">In ASP.NET Core 2.0 wird die Konfiguration außerhalb der `Startup`-Klasse initialisiert.</span><span class="sxs-lookup"><span data-stu-id="840b4-121">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="840b4-122">Anwendungen mit EF Core greifen in der Regel über die Konfiguration auf ihre Verbindungszeichenfolge zu, sodass `Startup` allein nicht mehr ausreicht.</span><span class="sxs-lookup"><span data-stu-id="840b4-122">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="840b4-123">Wenn Sie ein Upgrade für eine ASP.NET Core 1.x-Anwendung durchführen, wird möglicherweise der folgende Fehler ausgelöst, wenn Sie EF Core-Tools verwenden.</span><span class="sxs-lookup"><span data-stu-id="840b4-123">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="840b4-124">No parameterless constructor was found on „ApplicationContext'“. (Es wurde kein parameterloser Konstruktor in „ApplicationContext“ gefunden).</span><span class="sxs-lookup"><span data-stu-id="840b4-124">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="840b4-125">Fügen Sie entweder einen parameterlosen Konstruktor zu „ApplicationContext“ hinzu, oder fügen Sie eine Implementierung von „IDesignTimeDbContextFactory&lt;ApplicationContext&gt;“ in derselben Assembly wie „ApplicationContext“ hinzu.</span><span class="sxs-lookup"><span data-stu-id="840b4-125">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="840b4-126">Zur Standardvorlage von ASP.NET Core 2.0 wurde ein neues Entwurfszeithook hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="840b4-126">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="840b4-127">Die statische `Program.BuildWebHost`-Methode ermöglicht EF Core zur Entwurfszeit den Zugriff auf den Dienstanbieter der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="840b4-127">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="840b4-128">Wenn Sie ein Upgrade für eine ASP.NET Core 1.x-Anwendung durchführen, müssen Sie die `Program`-Klasse aktualisieren, damit sie der folgenden ähnelt.</span><span class="sxs-lookup"><span data-stu-id="840b4-128">If you are upgrading an ASP.NET Core 1.x application, you will need to update the `Program` class to resemble the following.</span></span>

```csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

<span data-ttu-id="840b4-129">Die Einführung dieses Musters beim Durchführen von Updates auf Version 2.0 für Anwendung wird dringend empfohlen und ist erforderlich, damit Produktfeatures wie Entity Framework Core-Migrationen funktionieren.</span><span class="sxs-lookup"><span data-stu-id="840b4-129">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="840b4-130">Die gängige Alternative besteht darin, [*IDesignTimeDbContextFactory\<TContext>* zu implementieren](xref:core/cli/dbcontext-creation#from-a-design-time-factory).</span><span class="sxs-lookup"><span data-stu-id="840b4-130">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](xref:core/cli/dbcontext-creation#from-a-design-time-factory).</span></span>

## <a name="idbcontextfactory-renamed"></a><span data-ttu-id="840b4-131">Umbenennung von IDbContextFactory</span><span class="sxs-lookup"><span data-stu-id="840b4-131">IDbContextFactory renamed</span></span>

<span data-ttu-id="840b4-132">In der Vergangenheit wurde die `IDbContextFactory<TContext>`-Schnittstelle zur Verfügung gestellt, um diverse Anwendungsmuster zu unterstützen und Benutzern mehr Kontrolle über die Verwendung von `DbContext` zur Entwurfszeit zu bieten.</span><span class="sxs-lookup"><span data-stu-id="840b4-132">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="840b4-133">Zur Entwurfszeit ermitteln die EF Core-Tools Implementierungen dieser Schnittstelle in Ihrem Projekt und nutzen diese zum Erstellen von `DbContext`-Objekten.</span><span class="sxs-lookup"><span data-stu-id="840b4-133">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="840b4-134">Diese Schnittstelle hatte einen sehr allgemeinen Namen, der einige Benutzer insofern irregeführt hat, dass sie versucht haben, sie für andere Szenarios zum Erstellen von `DbContext` wiederzuverwenden.</span><span class="sxs-lookup"><span data-stu-id="840b4-134">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="840b4-135">Diese Benutzer waren dann überrascht, wenn die EF-Tools daraufhin versuchten, ihre Implementierung zur Entwurfszeit zu verwenden, was zu Fehlern bei Befehlen wie `Update-Database` oder `dotnet ef database update` führte.</span><span class="sxs-lookup"><span data-stu-id="840b4-135">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="840b4-136">Die Schnittstelle wurde in `IDesignTimeDbContextFactory<TContext>` umbenannt, um die starke Entwurfszeitsemantik dieser Schnittstelle zu verdeutlichen.</span><span class="sxs-lookup"><span data-stu-id="840b4-136">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="840b4-137">Für das Release der Version 2.0 ist die Schnittstelle `IDbContextFactory<TContext>` weiterhin vorhanden, jedoch wurde sie als veraltet gekennzeichnet.</span><span class="sxs-lookup"><span data-stu-id="840b4-137">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

## <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="840b4-138">Entfernung von DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="840b4-138">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="840b4-139">Aufgrund der oben beschriebenen ASP.NET Core 2.0-Änderungen wurde festgestellt, dass `DbContextFactoryOptions` nicht mehr für die neue `IDesignTimeDbContextFactory<TContext>`-Schnittstelle benötigt wurde.</span><span class="sxs-lookup"><span data-stu-id="840b4-139">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="840b4-140">Im Folgenden finden Sie Alternativen, die Sie stattdessen verwenden sollten.</span><span class="sxs-lookup"><span data-stu-id="840b4-140">Here are the alternatives you should be using instead.</span></span>

| <span data-ttu-id="840b4-141">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="840b4-141">DbContextFactoryOptions</span></span> | <span data-ttu-id="840b4-142">Alternative</span><span class="sxs-lookup"><span data-stu-id="840b4-142">Alternative</span></span>                                                  |
|:------------------------|:-------------------------------------------------------------|
| <span data-ttu-id="840b4-143">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="840b4-143">ApplicationBasePath</span></span>     | <span data-ttu-id="840b4-144">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="840b4-144">AppContext.BaseDirectory</span></span>                                     |
| <span data-ttu-id="840b4-145">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="840b4-145">ContentRootPath</span></span>         | <span data-ttu-id="840b4-146">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="840b4-146">Directory.GetCurrentDirectory()</span></span>                              |
| <span data-ttu-id="840b4-147">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="840b4-147">EnvironmentName</span></span>         | <span data-ttu-id="840b4-148">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="840b4-148">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span> |

## <a name="design-time-working-directory-changed"></a><span data-ttu-id="840b4-149">Änderung am Entwurfszeit-Arbeitsverzeichnis</span><span class="sxs-lookup"><span data-stu-id="840b4-149">Design-time working directory changed</span></span>

<span data-ttu-id="840b4-150">Die ASP.NET Core 2.0-Änderungen erforderten außerdem, dass das von `dotnet ef` verwendete Arbeitsverzeichnis dem von Visual Studio verwendeten Arbeitsverzeichnis entspricht, wenn Ihre Anwendung ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="840b4-150">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="840b4-151">Eine beobachtbare Nebenwirkung hiervon besteht darin, dass SQLite-Dateinamen sich nun nach dem Projektverzeichnis richten, anstatt wie zuvor nach dem Ausgabeverzeichnis.</span><span class="sxs-lookup"><span data-stu-id="840b4-151">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

## <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="840b4-152">EF Core 2.0 erfordert einen 2.0-Datenbankanbieter</span><span class="sxs-lookup"><span data-stu-id="840b4-152">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="840b4-153">Für EF Core 2.0 wurden viele Vereinfachungen und Verbesserungen an der Funktionsweise von Datenbankanbietern vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="840b4-153">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="840b4-154">Das bedeutet, dass 1.0.x- und 1.1.x-Anbieter nicht mit EF Core 2.0 verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="840b4-154">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="840b4-155">Die SQL Server- und SQLite-Anbieter werden vom EF-Team bereitgestellt, und die entsprechenden 2.0-Versionen werden im Rahmen des Release von Version 2.0 zur Verfügung gestellt.</span><span class="sxs-lookup"><span data-stu-id="840b4-155">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="840b4-156">Die Open-Source-Drittanbieter für [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL) und [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) werden für Version 2.0 aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="840b4-156">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="840b4-157">Für Informationen zu allen anderen Anbietern wenden Sie sich an den Writer des Anbieters.</span><span class="sxs-lookup"><span data-stu-id="840b4-157">For all other providers, please contact the provider writer.</span></span>

## <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="840b4-158">Änderungen an der Protokollierung und an Diagnoseereignissen</span><span class="sxs-lookup"><span data-stu-id="840b4-158">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="840b4-159">Hinweis: Diese Änderungen sollten sich auf den meisten Anwendungscode nicht auswirken.</span><span class="sxs-lookup"><span data-stu-id="840b4-159">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="840b4-160">Die Ereignis-IDs für an eine [ILogger](/dotnet/api/microsoft.extensions.logging.ilogger)-Schnittstelle gesendete Nachrichten wurden in 2.0 geändert.</span><span class="sxs-lookup"><span data-stu-id="840b4-160">The event IDs for messages sent to an [ILogger](/dotnet/api/microsoft.extensions.logging.ilogger) have changed in 2.0.</span></span> <span data-ttu-id="840b4-161">Die Ereignis-IDs sind nun für alle EF Core-Codes eindeutig.</span><span class="sxs-lookup"><span data-stu-id="840b4-161">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="840b4-162">Diese Nachrichten entsprechen nun auch dem Standardmuster für die strukturierte Protokollierung, das z.B. von MVC eingesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="840b4-162">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="840b4-163">Die Protokollierungskategorien haben sich ebenfalls geändert.</span><span class="sxs-lookup"><span data-stu-id="840b4-163">Logger categories have also changed.</span></span> <span data-ttu-id="840b4-164">Nun gibt es eine bekannte Gruppe von Kategorien, auf die über [DbLoggerCategory](https://github.com/dotnet/efcore/blob/rel/2.0.0/src/EFCore/DbLoggerCategory.cs) zugegriffen werden kann.</span><span class="sxs-lookup"><span data-stu-id="840b4-164">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/dotnet/efcore/blob/rel/2.0.0/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="840b4-165">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md)-Ereignisse verwenden nun dieselben Ereignis-ID-Namen wie die entsprechenden `ILogger`-Nachrichten.</span><span class="sxs-lookup"><span data-stu-id="840b4-165">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="840b4-166">Die Ereignisnutzdaten sind nominale Typen, die von [EventData](/dotnet/api/microsoft.entityframeworkcore.diagnostics.eventdata) abgeleitet wurden.</span><span class="sxs-lookup"><span data-stu-id="840b4-166">The event payloads are all nominal types derived from [EventData](/dotnet/api/microsoft.entityframeworkcore.diagnostics.eventdata).</span></span>

<span data-ttu-id="840b4-167">Ereignis-IDs, Nutzdatentypen und Kategorien werden in den Klassen [CoreEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.coreeventid) und [RelationalEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.relationaleventid) dokumentiert.</span><span class="sxs-lookup"><span data-stu-id="840b4-167">Event IDs, payload types, and categories are documented in the [CoreEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.coreeventid) and the [RelationalEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.relationaleventid) classes.</span></span>

<span data-ttu-id="840b4-168">Außerdem wurden IDs von „Microsoft.EntityFrameworkCore.Infrastructure“ in den neuen Namespace „Microsoft.EntityFrameworkCore.Diagnostics“ verschoben.</span><span class="sxs-lookup"><span data-stu-id="840b4-168">IDs have also moved from Microsoft.EntityFrameworkCore.Infrastructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

## <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="840b4-169">Änderungen an der EF Core-API für relationale Metadaten</span><span class="sxs-lookup"><span data-stu-id="840b4-169">EF Core relational metadata API changes</span></span>

<span data-ttu-id="840b4-170">EF Core 2.0 erstellt nun eine andere [IModel](/dotnet/api/microsoft.entityframeworkcore.metadata.imodel)-Klasse für die verschiedenen verwendeten Anbieter.</span><span class="sxs-lookup"><span data-stu-id="840b4-170">EF Core 2.0 will now build a different [IModel](/dotnet/api/microsoft.entityframeworkcore.metadata.imodel) for each different provider being used.</span></span> <span data-ttu-id="840b4-171">Dies geschieht in der Regel auf eine für die Anwendung transparente Weise.</span><span class="sxs-lookup"><span data-stu-id="840b4-171">This is usually transparent to the application.</span></span> <span data-ttu-id="840b4-172">Dies hat eine Vereinfachung der untergeordneten Metadaten-APIs ermöglicht, sodass Zugriffe auf _gemeinsame relationale Metadatenkonzepte_ immer durch Aufrufen von `.Relational` statt `.SqlServer`, `.Sqlite` usw. erfolgen. Beispielsweise sollte der folgende 1.1.x-Code:</span><span class="sxs-lookup"><span data-stu-id="840b4-172">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

```csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="840b4-173">nun wie folgt geschrieben werden:</span><span class="sxs-lookup"><span data-stu-id="840b4-173">Should now be written like this:</span></span>

```csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="840b4-174">Anstatt Methoden wie `ForSqlServerToTable` zu verwenden, stehen Ihnen nun Erweiterungsmethoden zum Schreiben von Bedingungscode auf Grundlage des aktuell verwendeten Anbieters zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="840b4-174">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="840b4-175">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="840b4-175">For example:</span></span>

```csharp
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="840b4-176">Beachten Sie, dass diese Änderung nur für APIs und Metadaten gilt, die für _alle_ relationalen Anbieter definiert sind.</span><span class="sxs-lookup"><span data-stu-id="840b4-176">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="840b4-177">Die API und Metadaten bleiben unverändert, wenn sie für einen spezifischen einzelnen Anbieter vorgesehen sind.</span><span class="sxs-lookup"><span data-stu-id="840b4-177">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="840b4-178">Beispielsweise sind gruppierte Indizes für SQL Server vorgesehen, daher müssen `ForSqlServerIsClustered` und `.SqlServer().IsClustered()` weiterhin verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="840b4-178">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

## <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="840b4-179">Kontrolle des EF-Dienstanbieters nicht übernehmen</span><span class="sxs-lookup"><span data-stu-id="840b4-179">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="840b4-180">EF Core nutzt einen internen Container für die Abhängigkeitsinjektion (`IServiceProvider`) für die interne Implementierung.</span><span class="sxs-lookup"><span data-stu-id="840b4-180">EF Core uses an internal `IServiceProvider` (a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="840b4-181">Anwendungen sollten EF Core erlauben, diesen Anbieter zu erstellen und zu verwalten. Dies gilt in besonderen Fällen nicht.</span><span class="sxs-lookup"><span data-stu-id="840b4-181">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="840b4-182">Ziehen Sie unbedingt in Erwägung, jegliche Aufrufe von `UseInternalServiceProvider` zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="840b4-182">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="840b4-183">Wenn eine Anwendung `UseInternalServiceProvider` nicht aufrufen muss, ziehen Sie es in Betracht, [ein Issue einzureichen](https://github.com/dotnet/efcore/Issues), damit andere Lösungsmöglichkeiten für Ihr Szenario untersucht werden können.</span><span class="sxs-lookup"><span data-stu-id="840b4-183">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/dotnet/efcore/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="840b4-184">Aufrufe von `AddEntityFramework`, `AddEntityFrameworkSqlServer` und so weiter sind nicht für den Anwendungscode erforderlich, es sei denn, `UseInternalServiceProvider` wird ebenfalls aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="840b4-184">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="840b4-185">Entfernen Sie jegliche vorhandenen Aufrufe von `AddEntityFramework` oder `AddEntityFrameworkSqlServer`. `AddDbContext` sollte weiterhin wie zuvor verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="840b4-185">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

## <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="840b4-186">In-Memory-Datenbanken müssen Namen erhalten</span><span class="sxs-lookup"><span data-stu-id="840b4-186">In-memory databases must be named</span></span>

<span data-ttu-id="840b4-187">Die globale unbenannte In-Memory-Datenbank wurde entfernt, stattdessen müssen nun alle In-Memory-Datenbanken benannt werden.</span><span class="sxs-lookup"><span data-stu-id="840b4-187">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="840b4-188">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="840b4-188">For example:</span></span>

```csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="840b4-189">Hiermit wird eine Datenbank mit dem Namen „MyDatabase“ erstellt bzw. verwendet.</span><span class="sxs-lookup"><span data-stu-id="840b4-189">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="840b4-190">Wenn `UseInMemoryDatabase` noch mal mit demselben Namen aufgerufen wird, wird dieselbe In-Memory-Datenbank verwendet, wodurch diese gemeinsam von mehreren Kontextinstanzen verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="840b4-190">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

## <a name="read-only-api-changes"></a><span data-ttu-id="840b4-191">Änderungen an schreibgeschützten APIs</span><span class="sxs-lookup"><span data-stu-id="840b4-191">Read-only API changes</span></span>

<span data-ttu-id="840b4-192">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave` und `IsStoreGeneratedAlways` sind veraltet und wurden durch [BeforeSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.beforesavebehavior) und [AfterSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.aftersavebehavior) ersetzt.</span><span class="sxs-lookup"><span data-stu-id="840b4-192">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.beforesavebehavior) and [AfterSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.aftersavebehavior).</span></span> <span data-ttu-id="840b4-193">Diese Verhaltensweisen gelten für alle Eigenschaften (nicht nur für vom Speicher generierte Eigenschaften) und bestimmen, wie der Wert der Eigenschaft verwendet werden sollte, wenn in eine Datenbankzeile eingefügt (`BeforeSaveBehavior`) oder eine vorhandene Datenbank geändert wird (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="840b4-193">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="840b4-194">Mit [ValueGenerated.OnAddOrUpdate](/dotnet/api/microsoft.entityframeworkcore.metadata.valuegenerated) gekennzeichnete Eigenschaften (z. B. für berechnete Spalten) ignorieren standardmäßig jegliche Werte, die für die Eigenschaft festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="840b4-194">Properties marked as [ValueGenerated.OnAddOrUpdate](/dotnet/api/microsoft.entityframeworkcore.metadata.valuegenerated) (for example, for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="840b4-195">Das bedeutet, dass ein vom Speicher generierter Wert immer abgerufen wird, unabhängig davon, ob ein Wert der überwachten Entität festgelegt oder geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="840b4-195">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="840b4-196">Dies können Sie ändern, indem Sie andere `Before\AfterSaveBehavior`-Eigenschaften angeben.</span><span class="sxs-lookup"><span data-stu-id="840b4-196">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

## <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="840b4-197">Neues Löschverhalten von ClientSetNull</span><span class="sxs-lookup"><span data-stu-id="840b4-197">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="840b4-198">In vorherigen Releases verfügte [DeleteBehavior.Restrict](/dotnet/api/microsoft.entityframeworkcore.deletebehavior) über ein Verhalten für vom Kontext überwachte Entitäten, das eher mit `SetNull`-Semantiken übereinstimmte.</span><span class="sxs-lookup"><span data-stu-id="840b4-198">In previous releases, [DeleteBehavior.Restrict](/dotnet/api/microsoft.entityframeworkcore.deletebehavior) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="840b4-199">Mit EF Core 2.0 wurde ein neues `ClientSetNull`-Verhalten als Standardeinstellung für optionale Beziehungen eingeführt.</span><span class="sxs-lookup"><span data-stu-id="840b4-199">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="840b4-200">Dies Verhalten umfasst `SetNull`-Semantiken für überwachte Entitäten und `Restrict`-Verhalten für Datenbanken, die mit EF Core erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="840b4-200">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="840b4-201">Erfahrungsgemäß handelt es sich dabei um die am häufigsten erwarteten bzw. nützlichsten Verhalten für überwachte Entitäten und die Datenbank.</span><span class="sxs-lookup"><span data-stu-id="840b4-201">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="840b4-202">`DeleteBehavior.Restrict` wird nun für überwachte Entitäten berücksichtigt, wenn es für optionale Beziehungen festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="840b4-202">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

## <a name="provider-design-time-packages-removed"></a><span data-ttu-id="840b4-203">Entwurfszeitpakete für Anbieter wurden entfernt</span><span class="sxs-lookup"><span data-stu-id="840b4-203">Provider design-time packages removed</span></span>

<span data-ttu-id="840b4-204">Das Paket `Microsoft.EntityFrameworkCore.Relational.Design` wurde entfernt.</span><span class="sxs-lookup"><span data-stu-id="840b4-204">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="840b4-205">Die Inhalte wurden in `Microsoft.EntityFrameworkCore.Relational` und `Microsoft.EntityFrameworkCore.Design` konsolidiert.</span><span class="sxs-lookup"><span data-stu-id="840b4-205">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="840b4-206">Dies wird in die Entwurfszeitpakete für Anbieter weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="840b4-206">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="840b4-207">Diese Pakete (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design` usw.) wurden entfernt, und ihre Inhalte wurden in die Hauptpakete für Anbieter konsolidiert.</span><span class="sxs-lookup"><span data-stu-id="840b4-207">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="840b4-208">Zum Aktivieren von `Scaffold-DbContext` oder `dotnet ef dbcontext scaffold` in EF Core 2.0 müssen Sie lediglich auf ein einzelnes Anbieterpaket verweisen:</span><span class="sxs-lookup"><span data-stu-id="840b4-208">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

```xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
