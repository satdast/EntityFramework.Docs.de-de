---
title: Dbcontext-Pooling
description: Dbcontext-Pooling in Entity Framework Core
author: rick-anderson
ms.author: riande
ms.date: 9/19/2020
uid: core/miscellaneous/context-pooling
ms.openlocfilehash: 8638c838511be85bd994751b9911b107974dfe2f
ms.sourcegitcommit: 0a25c03fa65ae6e0e0e3f66bac48d59eceb96a5a
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/14/2020
ms.locfileid: "92061956"
---
# <a name="dbcontext-pooling"></a><span data-ttu-id="54998-103">DbContext-Pooling</span><span class="sxs-lookup"><span data-stu-id="54998-103">DbContext pooling</span></span>

<span data-ttu-id="54998-104">`AddDbContextPool` ermöglicht das Pooling von `DbContext` Instanzen.</span><span class="sxs-lookup"><span data-stu-id="54998-104">`AddDbContextPool` enables pooling of `DbContext` instances.</span></span> <span data-ttu-id="54998-105">Durch das Kontext Pooling kann der Durchsatz in Szenarios mit hoher Skalierung (z. b. Webserver durch Wiederverwendung von Kontext Instanzen) gesteigert werden, anstatt für jede Anforderung neue Instanzen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="54998-105">Context pooling can increase throughput in high-scale scenarios such as web servers by reusing context instances, rather than creating new instances for each request.</span></span>

<span data-ttu-id="54998-106">Das typische Muster in einer ASP.net Core-APP, die EF Core verwendet, umfasst das Registrieren eines benutzerdefinierten <xref:Microsoft.EntityFrameworkCore.DbContext> Typs im Container für die [Abhängigkeitsinjektion](/aspnet/core/fundamentals/dependency-injection) und das Abrufen von Instanzen dieses Typs über Konstruktorparameter in Controllern oder Razor pages.</span><span class="sxs-lookup"><span data-stu-id="54998-106">The typical pattern in an ASP.NET Core app using EF Core involves registering a custom <xref:Microsoft.EntityFrameworkCore.DbContext> type into the [dependency injection](/aspnet/core/fundamentals/dependency-injection) container and obtaining instances of that type through constructor parameters in controllers or Razor Pages.</span></span> <span data-ttu-id="54998-107">Mithilfe der Konstruktorinjektion wird für jede Anforderung eine neue Kontext Instanz erstellt.</span><span class="sxs-lookup"><span data-stu-id="54998-107">Using constructor injection, a new context instance is created for each request.</span></span>

<span data-ttu-id="54998-108"><xref:Microsoft.Extensions.DependencyInjection.EntityFrameworkServiceCollectionExtensions.AddDbContextPool%2A> aktiviert einen Pool von wiederverwendbaren Kontext Instanzen.</span><span class="sxs-lookup"><span data-stu-id="54998-108"><xref:Microsoft.Extensions.DependencyInjection.EntityFrameworkServiceCollectionExtensions.AddDbContextPool%2A> enables a pool of reusable context instances.</span></span> <span data-ttu-id="54998-109">Um Kontext Pooling zu verwenden, verwenden Sie die- `AddDbContextPool` Methode anstelle von `AddDbContext` bei der Dienst Registrierung:</span><span class="sxs-lookup"><span data-stu-id="54998-109">To use context pooling, use the `AddDbContextPool` method instead of `AddDbContext` during service registration:</span></span>

```csharp
services.AddDbContextPool<BloggingContext>(
    options => options.UseSqlServer(connectionString));
```

<span data-ttu-id="54998-110">Wenn zum `AddDbContextPool` Zeitpunkt der Anforderung einer Kontext Instanz verwendet wird, prüft EF zunächst, ob eine Instanz im Pool verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="54998-110">When `AddDbContextPool` is used, at the time a context instance is requested, EF first checks if there is an instance available in the pool.</span></span> <span data-ttu-id="54998-111">Sobald die Anforderungsverarbeitung abgeschlossen ist, werden alle Zustände der Instanz zurückgesetzt, und die Instanz selbst wird an den Pool zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="54998-111">Once the request processing finalizes, any state on the instance is reset and the instance is itself returned to the pool.</span></span>

<span data-ttu-id="54998-112">Dies ist konzeptionell vergleichbar mit der Funktionsweise von Verbindungspooling in ADO.NET-Anbietern und hat den Vorteil, dass einige der Kosten für die Initialisierung der Kontext Instanz eingespart werden.</span><span class="sxs-lookup"><span data-stu-id="54998-112">This is conceptually similar to how connection pooling operates in ADO.NET providers and has the advantage of saving some of the cost of initialization of the context instance.</span></span>

<span data-ttu-id="54998-113">Der- `poolSize` Parameter von <xref:Microsoft.Extensions.DependencyInjection.EntityFrameworkServiceCollectionExtensions.AddDbContextPool%2A> legt die maximale Anzahl von-Instanzen fest, die vom Pool beibehalten werden.</span><span class="sxs-lookup"><span data-stu-id="54998-113">The `poolSize` parameter of <xref:Microsoft.Extensions.DependencyInjection.EntityFrameworkServiceCollectionExtensions.AddDbContextPool%2A> sets the maximum number of instances retained by the pool.</span></span> <span data-ttu-id="54998-114">Sobald `poolSize` überschritten wird, werden neue Kontext Instanzen nicht zwischengespeichert, und EF greift auf das nicht-Pooling-Verhalten zurück, wenn Bedarfs gesteuert Instanzen erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="54998-114">Once `poolSize` is exceeded, new context instances are not cached and  EF falls back to the non-pooling behavior of creating instances on demand.</span></span>

## <a name="limitations"></a><span data-ttu-id="54998-115">Einschränkungen</span><span class="sxs-lookup"><span data-stu-id="54998-115">Limitations</span></span>

<span data-ttu-id="54998-116">Für apps sollte ein Profil erstellt und getestet werden, um anzuzeigen, dass die kontextinitialisierung einen erheblichen Aufwand verursacht.</span><span class="sxs-lookup"><span data-stu-id="54998-116">Apps should be profiled and tested to show that context initialization is a significant cost.</span></span>

<span data-ttu-id="54998-117">`AddDbContextPool` in gibt es einige Einschränkungen, die in der- `OnConfiguring` Methode des-Kontexts ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="54998-117">`AddDbContextPool` has a few limitations on what can be done in the `OnConfiguring` method of the context.</span></span>

> [!WARNING]
> <span data-ttu-id="54998-118">Vermeiden Sie die Verwendung von Kontext Pooling in apps, die den Zustand beibehalten.</span><span class="sxs-lookup"><span data-stu-id="54998-118">Avoid using context pooling in apps that maintain state.</span></span> <span data-ttu-id="54998-119">Beispielsweise private Felder im Kontext, die nicht über Anforderungen hinweg freigegeben werden sollten.</span><span class="sxs-lookup"><span data-stu-id="54998-119">For example, private fields in the context that shouldn't be shared across requests.</span></span> <span data-ttu-id="54998-120">EF Core setzt den Zustand, den es kennt, nur dann zurück, wenn dem Pool eine Kontext Instanz hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="54998-120">EF Core only resets the state that it is aware of before adding a context instance to the pool.</span></span>

<span data-ttu-id="54998-121">Das Kontext Pooling verwendet die gleiche Kontext Instanz in allen Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="54998-121">Context pooling works by reusing the same context instance across requests.</span></span> <span data-ttu-id="54998-122">Dies bedeutet, dass Sie als [Singleton](/aspnet/core/fundamentals/dependency-injection#service-lifetimes) in Bezug auf die Instanz selbst registriert ist, damit Sie persistent gespeichert werden kann.</span><span class="sxs-lookup"><span data-stu-id="54998-122">This means that it's effectively registered as a [Singleton](/aspnet/core/fundamentals/dependency-injection#service-lifetimes) in terms of the instance itself so that it's able to persist.</span></span>

<span data-ttu-id="54998-123">Das Kontext Pooling ist für Szenarien vorgesehen, in denen die Kontext Konfiguration, die die aufgelösten Dienste umfasst, zwischen Anforderungen korrigiert wird.</span><span class="sxs-lookup"><span data-stu-id="54998-123">Context pooling is intended for scenarios where the context configuration, which includes services resolved, is fixed between requests.</span></span> <span data-ttu-id="54998-124">Für Fälle, [in denen](/aspnet/core/fundamentals/dependency-injection#service-lifetimes) Bereichs bezogene Dienste erforderlich sind oder die Konfiguration geändert werden muss, verwenden Sie Pooling nicht.</span><span class="sxs-lookup"><span data-stu-id="54998-124">For cases where [Scoped](/aspnet/core/fundamentals/dependency-injection#service-lifetimes) services are required, or configuration needs to be changed, don't use pooling.</span></span> <span data-ttu-id="54998-125">Der Leistungsgewinn von Pooling ist in der Regel mit Ausnahme von hochgradig optimierten Szenarien unerheblich.</span><span class="sxs-lookup"><span data-stu-id="54998-125">The performance gain from pooling is usually negligible except in highly optimized scenarios.</span></span>
