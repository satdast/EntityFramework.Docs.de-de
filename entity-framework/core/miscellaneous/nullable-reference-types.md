---
title: Arbeiten mit Verweis Typen, die NULL-Werte zulassen-EF Core
description: Arbeiten mit Verweis Typen, die NULL-Werte zulassen, bei Verwendung von Entity Framework Core
author: roji
ms.date: 09/09/2019
uid: core/miscellaneous/nullable-reference-types
ms.openlocfilehash: 648b79576838d2ba424b5216d5ad6811912f8ccb
ms.sourcegitcommit: f3512e3a98e685a3ba409c1d0157ce85cc390cf4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/10/2020
ms.locfileid: "94429714"
---
# <a name="working-with-nullable-reference-types"></a><span data-ttu-id="f51f1-103">Arbeiten mit Verweis Typen, die NULL-Werte zulassen</span><span class="sxs-lookup"><span data-stu-id="f51f1-103">Working with Nullable Reference Types</span></span>

<span data-ttu-id="f51f1-104">In c# 8 wurde ein neues Feature namens " [Werte zulässt Reference Types (NRT)](/dotnet/csharp/tutorials/nullable-reference-types)" eingeführt, sodass Verweis Typen mit Anmerkungen versehen werden können. Dies gibt an, ob es zulässig ist, dass Sie NULL enthalten.</span><span class="sxs-lookup"><span data-stu-id="f51f1-104">C# 8 introduced a new feature called [nullable reference types (NRT)](/dotnet/csharp/tutorials/nullable-reference-types), allowing reference types to be annotated, indicating whether it is valid for them to contain null or not.</span></span> <span data-ttu-id="f51f1-105">Wenn Sie mit dieser Funktion noch nicht vertraut sind, sollten Sie sich mit der Dokumentation vertraut machen, indem Sie die c#-Dokumentation lesen.</span><span class="sxs-lookup"><span data-stu-id="f51f1-105">If you are new to this feature, it is recommended that make yourself familiar with it by reading the C# docs.</span></span>

<span data-ttu-id="f51f1-106">Auf dieser Seite wird EF Core Unterstützung für Verweis Typen eingeführt, die NULL-Werte zulassen, und es werden bewährte Methoden zum Arbeiten mit diesen beschrieben.</span><span class="sxs-lookup"><span data-stu-id="f51f1-106">This page introduces EF Core's support for nullable reference types, and describes best practices for working with them.</span></span>

## <a name="required-and-optional-properties"></a><span data-ttu-id="f51f1-107">Erforderliche und optionale Eigenschaften</span><span class="sxs-lookup"><span data-stu-id="f51f1-107">Required and optional properties</span></span>

<span data-ttu-id="f51f1-108">Die Haupt Dokumentation zu den erforderlichen und optionalen Eigenschaften sowie deren Interaktion mit Verweis Typen, die NULL-Werte zulassen, ist die [erforderliche und optionale Eigenschaften](xref:core/modeling/entity-properties#required-and-optional-properties) Seite.</span><span class="sxs-lookup"><span data-stu-id="f51f1-108">The main documentation on required and optional properties and their interaction with nullable reference types is the [Required and Optional Properties](xref:core/modeling/entity-properties#required-and-optional-properties) page.</span></span> <span data-ttu-id="f51f1-109">Es wird empfohlen, dass Sie zunächst die Seite lesen.</span><span class="sxs-lookup"><span data-stu-id="f51f1-109">It is recommended you start out by reading that page first.</span></span>

> [!NOTE]
> <span data-ttu-id="f51f1-110">Vorsicht beim Aktivieren von Verweis Typen, die NULL-Werte zulassen, für ein vorhandenes Projekt: Verweistyp Eigenschaften, die zuvor als optional konfiguriert wurden, werden nun als erforderlich konfiguriert, es sei denn, Sie sind explizit mit Anmerkungen versehen, die NULL-Werte zulassen.</span><span class="sxs-lookup"><span data-stu-id="f51f1-110">Exercise caution when enabling nullable reference types on an existing project: reference type properties which were previously configured as optional will now be configured as required, unless they are explicitly annotated to be nullable.</span></span> <span data-ttu-id="f51f1-111">Wenn Sie ein relationales Datenbankschema verwalten, kann dies dazu führen, dass Migrationen generiert werden, die die NULL-Zulässigkeit der Daten Bank Spalte ändern.</span><span class="sxs-lookup"><span data-stu-id="f51f1-111">When managing a relational database schema, this may cause migrations to be generated which alter the database column's nullability.</span></span>

## <a name="non-nullable-properties-and-initialization"></a><span data-ttu-id="f51f1-112">Eigenschaften und Initialisierung, die keine NULL-Werte zulassen</span><span class="sxs-lookup"><span data-stu-id="f51f1-112">Non-nullable properties and initialization</span></span>

<span data-ttu-id="f51f1-113">Wenn Verweis Typen, die NULL-Werte zulassen, aktiviert sind, gibt der c#-Compiler Warnungen für jede nicht initialisierte Eigenschaft aus, die keine NULL-Werte zulässt, da diese NULL enthalten würden.</span><span class="sxs-lookup"><span data-stu-id="f51f1-113">When nullable reference types are enabled, the C# compiler emits warnings for any uninitialized non-nullable property, as these would contain null.</span></span> <span data-ttu-id="f51f1-114">Folglich kann die folgende, gängige Methode zum Schreiben von Entitäts Typen nicht verwendet werden:</span><span class="sxs-lookup"><span data-stu-id="f51f1-114">As a result, the following, common way of writing entity types cannot be used:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/CustomerWithWarning.cs?name=CustomerWithWarning&highlight=4-5)]

<span data-ttu-id="f51f1-115">Die [konstruktorbindung](xref:core/modeling/constructors) ist eine nützliche Methode, um sicherzustellen, dass die Eigenschaften, die keine NULL-Werte zulassen, initialisiert werden:</span><span class="sxs-lookup"><span data-stu-id="f51f1-115">[Constructor binding](xref:core/modeling/constructors) is a useful technique to ensure that your non-nullable properties are initialized:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/CustomerWithConstructorBinding.cs?name=CustomerWithConstructorBinding&highlight=6-9)]

<span data-ttu-id="f51f1-116">Leider ist die konstruktorbindung in einigen Szenarios keine Option. Navigations Eigenschaften können z. b. nicht auf diese Weise initialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="f51f1-116">Unfortunately, in some scenarios constructor binding isn't an option; navigation properties, for example, cannot be initialized in this way.</span></span>

<span data-ttu-id="f51f1-117">Erforderliche Navigations Eigenschaften stellen eine zusätzliche Schwierigkeit dar: Obwohl eine abhängige für einen bestimmten Prinzipal immer vorhanden ist, kann Sie von einer bestimmten Abfrage geladen werden, abhängig von den Anforderungen zu diesem Zeitpunkt im Programm (Weitere Informationen[finden Sie unter unterschiedliche Muster zum Laden von Daten](xref:core/querying/related-data)).</span><span class="sxs-lookup"><span data-stu-id="f51f1-117">Required navigation properties present an additional difficulty: although a dependent will always exist for a given principal, it may or may not be loaded by a particular query, depending on the needs at that point in the program ([see the different patterns for loading data](xref:core/querying/related-data)).</span></span> <span data-ttu-id="f51f1-118">Gleichzeitig ist es nicht wünschenswert, dass diese Eigenschaften auf NULL festgelegt werden, da dadurch der gesamte Zugriff auf NULL erzwungen werden würde, auch wenn Sie erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="f51f1-118">At the same time, it is undesirable to make these properties nullable, since that would force all access to them to check for null, even if they are required.</span></span>

<span data-ttu-id="f51f1-119">Eine Möglichkeit zum Umgang mit diesen Szenarien besteht darin, eine Eigenschaft, die keine NULL-Werte zulässt, mit einem dahinter liegenden [Feld](xref:core/modeling/backing-field)zu haben, das NULL-Werte zulässt</span><span class="sxs-lookup"><span data-stu-id="f51f1-119">One way to deal with these scenarios, is to have a non-nullable property with a nullable [backing field](xref:core/modeling/backing-field):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Order.cs?range=10-17)]

<span data-ttu-id="f51f1-120">Da die Navigations Eigenschaft keine NULL-Werte zulässt, wird eine erforderliche Navigation konfiguriert. solange die Navigation ordnungsgemäß geladen ist, kann auf den abhängigen über die-Eigenschaft zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="f51f1-120">Since the navigation property is non-nullable, a required navigation is configured; and as long as the navigation is properly loaded, the dependent will be accessible via the property.</span></span> <span data-ttu-id="f51f1-121">Wenn jedoch auf die Eigenschaft zugegriffen wird, ohne dass die zugehörige Entität zuvor ordnungsgemäß geladen wurde, wird eine InvalidOperationException ausgelöst, da der API-Vertrag falsch verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="f51f1-121">If, however, the property is accessed without first properly loading the related entity, an InvalidOperationException is thrown, since the API contract has been used incorrectly.</span></span> <span data-ttu-id="f51f1-122">Beachten Sie, dass EF so konfiguriert werden muss, dass immer auf das dahinter liegende Feld und nicht auf die-Eigenschaft zugegriffen wird, da es darauf basiert, dass der Wert auch dann gelesen werden kann, wenn er nicht Lesen Sie die Dokumentation zu den entsprechenden [Feldern](xref:core/modeling/backing-field) , und `PropertyAccessMode.Field` Geben Sie ggf. an, um sicherzustellen, dass die Konfiguration korrekt ist.</span><span class="sxs-lookup"><span data-stu-id="f51f1-122">Note that EF must be configured to always access the backing field and not the property, as it relies on being able to read the value even when unset; consult the documentation on [backing fields](xref:core/modeling/backing-field) on how to do this, and consider specifying `PropertyAccessMode.Field` to make sure the configuration is correct.</span></span>

<span data-ttu-id="f51f1-123">Als terser Alternative ist es möglich, die-Eigenschaft mit der Hilfe des NULL-Operator (!) einfach mit NULL zu initialisieren:</span><span class="sxs-lookup"><span data-stu-id="f51f1-123">As a terser alternative, it is possible to simply initialize the property to null with the help of the null-forgiving operator (!):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Order.cs?range=19)]

<span data-ttu-id="f51f1-124">Ein tatsächlicher Null-Wert wird nie beobachtet, außer aufgrund eines Programmierfehlers, z. b. durch den Zugriff auf die Navigations Eigenschaft, ohne dass die zugehörige Entität vorab ordnungsgemäß geladen wird.</span><span class="sxs-lookup"><span data-stu-id="f51f1-124">An actual null value will never be observed except as a result of a programming bug, e.g. accessing the navigation property without properly loading the related entity beforehand.</span></span>

> [!NOTE]
> <span data-ttu-id="f51f1-125">Sammlungs Navigation, die Verweise auf mehrere verknüpfte Entitäten enthalten, sollte immer keine NULL-Werte zulassen.</span><span class="sxs-lookup"><span data-stu-id="f51f1-125">Collection navigations, which contain references to multiple related entities, should always be non-nullable.</span></span> <span data-ttu-id="f51f1-126">Eine leere Auflistung bedeutet, dass keine verknüpften Entitäten vorhanden sind, aber die Liste selbst darf nie NULL sein.</span><span class="sxs-lookup"><span data-stu-id="f51f1-126">An empty collection means that no related entities exist, but the list itself should never be null.</span></span>

## <a name="dbcontext-and-dbset"></a><span data-ttu-id="f51f1-127">Dbcontext und dbset</span><span class="sxs-lookup"><span data-stu-id="f51f1-127">DbContext and DbSet</span></span>

<span data-ttu-id="f51f1-128">Die übliche Vorgehensweise, dass nicht initialisierte dbset-Eigenschaften für Kontext Typen verwendet werden, ist ebenfalls problematisch, da der Compiler jetzt Warnungen für Sie ausgibt.</span><span class="sxs-lookup"><span data-stu-id="f51f1-128">The common practice of having uninitialized DbSet properties on context types is also problematic, as the compiler will now emit warnings for them.</span></span> <span data-ttu-id="f51f1-129">Dies kann wie folgt korrigiert werden:</span><span class="sxs-lookup"><span data-stu-id="f51f1-129">This can be fixed as follows:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/NullableReferenceTypesContext.cs?name=Context&highlight=3-4)]

<span data-ttu-id="f51f1-130">Eine andere Strategie besteht darin, nicht auf NULL festleg Bare Auto-Eigenschaften zu verwenden, diese jedoch mit NULL zu initialisieren, indem der NULL-verzweigende Operator (!) verwendet wird, um die Compilerwarnung zu stillen.</span><span class="sxs-lookup"><span data-stu-id="f51f1-130">Another strategy is to use non-nullable auto-properties, but to initialize them to null, using the null-forgiving operator (!) to silence the compiler warning.</span></span> <span data-ttu-id="f51f1-131">Der dbcontext-Basiskonstruktor stellt sicher, dass alle dbset-Eigenschaften initialisiert werden und NULL niemals für Sie beachtet wird.</span><span class="sxs-lookup"><span data-stu-id="f51f1-131">The DbContext base constructor ensures that all DbSet properties will get initialized, and null will never be observed on them.</span></span>

## <a name="navigating-and-including-nullable-relationships"></a><span data-ttu-id="f51f1-132">Navigieren in und einschließen von null-fähigen Beziehungen</span><span class="sxs-lookup"><span data-stu-id="f51f1-132">Navigating and including nullable relationships</span></span>

<span data-ttu-id="f51f1-133">Beim Umgang mit optionalen Beziehungen können Compilerwarnungen auftreten, bei denen eine tatsächliche NULL-Verweis Ausnahme nicht möglich wäre.</span><span class="sxs-lookup"><span data-stu-id="f51f1-133">When dealing with optional relationships, it's possible to encounter compiler warnings where an actual null reference exception would be impossible.</span></span> <span data-ttu-id="f51f1-134">Wenn Sie Ihre LINQ-Abfragen übersetzen und ausführen, stellt EF Core sicher, dass die Navigation zu dieser nicht ausgelöst wird, wenn eine optionale verknüpfte Entität nicht vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="f51f1-134">When translating and executing your LINQ queries, EF Core guarantees that if an optional related entity does not exist, any navigation to it will simply be ignored, rather than throwing.</span></span> <span data-ttu-id="f51f1-135">Der Compiler kennt diese EF Core Garantie jedoch nicht und führt Warnungen aus, als ob die LINQ-Abfrage im Arbeitsspeicher ausgeführt wurde, mit LINQ to Objects.</span><span class="sxs-lookup"><span data-stu-id="f51f1-135">However, the compiler is unaware of this EF Core guarantee, and produces warnings as if the LINQ query were executed in memory, with LINQ to Objects.</span></span> <span data-ttu-id="f51f1-136">Daher ist es erforderlich, dass der Compiler den NULL-Operator (!) verwendet, um den Compiler darüber zu informieren, dass ein tatsächlicher Null-Wert nicht möglich ist:</span><span class="sxs-lookup"><span data-stu-id="f51f1-136">As a result, it is necessary to use the null-forgiving operator (!) to inform the compiler that an actual null value isn't possible:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Program.cs?range=46)]

<span data-ttu-id="f51f1-137">Ein ähnliches Problem tritt auf, wenn mehrere Beziehungs Ebenen über optionale Navigationen eingeschlossen werden:</span><span class="sxs-lookup"><span data-stu-id="f51f1-137">A similar issue occurs when including multiple levels of relationships across optional navigations:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Program.cs?range=36-39&highlight=2)]

<span data-ttu-id="f51f1-138">Wenn Sie dies sehr viel tun und die fraglichen Entitäts Typen vorwiegend (oder exklusiv) in EF Core Abfragen verwendet werden, sollten Sie die Navigations Eigenschaften in Erwägung ziehen, die nicht auf NULL festgelegt werden können, und Sie über die fließende API oder Daten Anmerkungen als optional konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="f51f1-138">If you find yourself doing this a lot, and the entity types in question are predominantly (or exclusively) used in EF Core queries, consider making the navigation properties non-nullable, and to configure them as optional via the Fluent API or Data Annotations.</span></span> <span data-ttu-id="f51f1-139">Dadurch werden alle Compilerwarnungen entfernt, während die Beziehung optional bleibt. Wenn die Entitäten jedoch außerhalb EF Core durchlaufen werden, werden möglicherweise NULL-Werte beachtet, obwohl die Eigenschaften als nicht auf NULL festleg Bare Werte kommentiert werden.</span><span class="sxs-lookup"><span data-stu-id="f51f1-139">This will remove all compiler warnings while keeping the relationship optional; however, if your entities are traversed outside of EF Core, you may observe null values although the properties are annotated as non-nullable.</span></span>

## <a name="limitations"></a><span data-ttu-id="f51f1-140">Einschränkungen</span><span class="sxs-lookup"><span data-stu-id="f51f1-140">Limitations</span></span>

* <span data-ttu-id="f51f1-141">Reverse Engineering unterstützt zurzeit keine [c# 8-Verweis Typen (NULL-Werte zulassen)](/dotnet/csharp/tutorials/nullable-reference-types): EF Core generiert immer c#-Code, der voraussetzt, dass das Feature deaktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="f51f1-141">Reverse engineering does not currently support [C# 8 nullable reference types (NRTs)](/dotnet/csharp/tutorials/nullable-reference-types): EF Core always generates C# code that assumes the feature is off.</span></span> <span data-ttu-id="f51f1-142">Beispielsweise werden Textspalten, die NULL-Werte zulassen, als Eigenschaft mit dem Typ `string` erstellt, nicht `string?` mit der fließenden API oder den Daten Anmerkungen, mit denen konfiguriert wird, ob eine Eigenschaft erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="f51f1-142">For example, nullable text columns will be scaffolded as a property with type `string` , not `string?`, with either the Fluent API or Data Annotations used to configure whether a property is required or not.</span></span> <span data-ttu-id="f51f1-143">Sie können den Gerüst Code bearbeiten und durch c#-Anmerkungen zur NULL-Zulässigkeit ersetzen.</span><span class="sxs-lookup"><span data-stu-id="f51f1-143">You can edit the scaffolded code and replace these with C# nullability annotations.</span></span> <span data-ttu-id="f51f1-144">Die Gerüstbau Unterstützung für Verweis Typen, die NULL-Werte zulassen, wird von Issue [#15520](https://github.com/dotnet/efcore/issues/15520)</span><span class="sxs-lookup"><span data-stu-id="f51f1-144">Scaffolding support for nullable reference types is tracked by issue [#15520](https://github.com/dotnet/efcore/issues/15520).</span></span>
* <span data-ttu-id="f51f1-145">Die öffentliche API-Oberfläche von EF Core wurde noch nicht für NULL-Zulässigkeit mit Anmerkungen versehen (die öffentliche API ist "Null-schräg"), was manchmal umständlich ist, wenn die NRT-Funktion aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="f51f1-145">EF Core's public API surface has not yet been annotated for nullability (the public API is "null-oblivious"), making it sometimes awkward to use when the NRT feature is turned on.</span></span> <span data-ttu-id="f51f1-146">Dies umfasst insbesondere die asynchronen LINQ-Operatoren, die von EF Core verfügbar gemacht werden, z. b. [firstordefaultasync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstOrDefaultAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_).</span><span class="sxs-lookup"><span data-stu-id="f51f1-146">This notably includes the async LINQ operators exposed by EF Core, such as [FirstOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstOrDefaultAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_).</span></span> <span data-ttu-id="f51f1-147">Wir planen, dies für die Version 5,0 zu beheben.</span><span class="sxs-lookup"><span data-stu-id="f51f1-147">We plan to address this for the 5.0 release.</span></span>
